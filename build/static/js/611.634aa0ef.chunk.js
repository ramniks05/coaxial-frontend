"use strict";(self.webpackChunklearning_management_system=self.webpackChunklearning_management_system||[]).push([[611],{611:(e,s,r)=>{r.r(s),r.d(s,{default:()=>o});var a=r(555),t=r(43),n=r(580),i=r(712),c=(r(595),r(579));const l=e=>{let{item:s,itemType:r="item",onEdit:a,onDelete:t,fields:n=[],badges:i=[]}=e;const l=()=>s.description,o=()=>s.createdByName;return(0,c.jsxs)("div",{className:"data-card",children:[(0,c.jsxs)("div",{className:"card-header",children:[(0,c.jsxs)("div",{className:"card-title",children:[(0,c.jsx)("h4",{children:(()=>{switch(r){case"subject":return s.subjectName||s.name;case"topic":return s.topicName||s.name;default:return s.name}})()}),(0,c.jsxs)("div",{className:"card-badges",children:[(0,c.jsx)("span",{className:"status-badge ".concat(s.isActive?"active":"inactive"),children:s.isActive?"Active":"Inactive"}),i.map(e=>{const{key:r,label:a,value:t,condition:n,style:i,icon:l}=e;if(n&&!n(s))return null;const o=t||s[r];return o?(0,c.jsxs)("span",{className:"structure-badge",style:i,children:[l," ",o]},r):null})]})]}),(0,c.jsxs)("div",{className:"card-actions",children:[(0,c.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>{a&&a(s)},children:"Edit"}),(0,c.jsx)("button",{className:"btn btn-danger btn-xs",onClick:()=>{t&&t(s.id)},children:"Delete"})]})]}),(0,c.jsxs)("div",{className:"card-content",children:[l()&&(0,c.jsx)("p",{className:"description",children:l()}),n.map(e=>{const{key:r,label:a,value:t,condition:n}=e;if(n&&!n(s))return null;const i="function"===typeof t?t(s):t||s[r];return i?(0,c.jsxs)("p",{children:[(0,c.jsxs)("strong",{children:[a,":"]})," ",i]},r):null})]}),(0,c.jsx)("div",{className:"card-footer",children:(0,c.jsxs)("small",{className:"text-muted",children:["Created: ",new Date(s.createdAt).toLocaleDateString(),o()&&(0,c.jsxs)("span",{children:[" by ",o()]})]})})]})},o=()=>{const{token:e,addNotification:s}=(0,n.nm)(),[r,o]=(0,t.useState)([]),[d,u]=(0,t.useState)([]),[m,h]=(0,t.useState)(!1),[p,x]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[f,g]=(0,t.useState)(""),[j,N]=(0,t.useState)({name:"",description:"",course:{id:""},displayOrder:"",isActive:!0});(0,t.useEffect)(()=>{e&&!T.current?S():e||(console.warn("No token available, skipping data fetch"),s({type:"warning",message:"Please log in to access exam management features",duration:5e3}))},[e]);const b=(0,t.useRef)(!0),A=(0,t.useRef)(!1),C=(0,t.useRef)(null),E=(0,t.useRef)({data:null,ts:0,courseTypeId:null}),w=(0,t.useRef)(""),k=(0,t.useRef)(0),T=(0,t.useRef)(!1);(0,t.useEffect)(()=>{!b.current&&A.current?f?(console.log("Course changed to:",f),R(null,f)):(console.log("Fetching all competitive exams"),R()):b.current=!1},[f]);const F=(0,t.useRef)(null),I=(0,t.useRef)(new Map),D=(0,t.useRef)(""),O=(0,t.useRef)(0);(0,t.useEffect)(()=>()=>{if(F.current)try{F.current.abort()}catch(e){}if(C.current)try{C.current.abort()}catch(e){}},[]);const S=async()=>{if(T.current)console.log("fetchData already in progress, skipping duplicate call");else try{if(T.current=!0,h(!0),console.log("ExamManagement - Token status:",{hasToken:!!e,tokenLength:e?e.length:0,tokenPreview:e?e.substring(0,20)+"...":"No token"}),!e)throw new Error("No authentication token available. Please log in again.");const s=Date.now(),t="courseType:2";if(2===E.current.courseTypeId&&E.current.data&&s-E.current.ts<5e3)u(E.current.data);else{if(C.current)try{C.current.abort()}catch(a){}C.current=new AbortController,w.current=t,k.current=s;const r=await(0,i.NJ)(e,2,0,100),n=r.content||r,c=Array.isArray(n)?n:[];u(c),E.current={data:c,ts:s,courseTypeId:2}}const n="type:|course:";let c;const l=I.current.get(n);if(l&&s-l.ts<5e3)c=l.data;else if(n===D.current&&s-O.current<2e3)c=null;else{if(F.current)try{F.current.abort()}catch(a){}F.current=new AbortController,D.current=n,O.current=s,c=await(0,i.Dl)(e),I.current.set(n,{data:c,ts:s})}if(console.log("ExamManagement - Raw API responses:",{examsData:c}),c){const e=c.content||c;o(Array.isArray(e)?e:[])}console.log("ExamManagement - Processed data:",{examsCount:Array.isArray(r)?r.length:0,coursesCount:Array.isArray(d)?d.length:0}),A.current=!0}catch(t){console.error("Error fetching data:",t);let e="Failed to fetch data";t.message.includes("Unauthorized")?e="Authentication failed. Please log in again.":t.message.includes("No authentication token")?e="Please log in to access this feature.":t.message.includes("Failed to fetch")&&(e="Unable to connect to server. Please check your connection."),s({type:"error",message:e,duration:7e3})}finally{h(!1),T.current=!1}},R=async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{h(!0);const s=r?parseInt(r):null,n=a?parseInt(a):null,c="type:".concat(s||"","|course:").concat(n||""),l=Date.now(),d=I.current.get(c);let u;if(d&&l-d.ts<5e3)u=d.data;else if(c===D.current&&l-O.current<2e3)u=[];else{if(F.current)try{F.current.abort()}catch(t){}F.current=new AbortController,D.current=c,O.current=l,u=await(0,i.Dl)(e,s,n),I.current.set(c,{data:u,ts:l})}const m=u.content||u;o(Array.isArray(m)?m:[])}catch(n){console.error("Error fetching exams:",n),s({type:"error",message:"Failed to fetch exams",duration:5e3})}finally{h(!1)}},P=e=>{var s;const r=(null===(s=e.course)||void 0===s?void 0:s.id)||e.courseId;N({name:e.name,description:e.description||"",course:{id:r||""},displayOrder:e.displayOrder||"",isActive:e.isActive}),r&&g(r.toString()),y(e.id),x(!0)},M=async r=>{if(window.confirm("Are you sure you want to delete this exam?"))try{h(!0),await(0,i.Dt)(e,r),s({type:"success",message:"Exam deleted successfully",duration:3e3}),I.current.clear(),E.current={data:null,ts:0,courseTypeId:null},f?R(null,f):R()}catch(a){console.error("Error deleting exam:",a),s({type:"error",message:"Failed to delete exam",duration:5e3})}finally{h(!1)}},U=()=>{N({name:"",description:"",course:{id:""},displayOrder:"",isActive:!0}),y(null),x(!1)};return(0,c.jsxs)("div",{className:"master-data-component",children:[(0,c.jsxs)("div",{className:"component-header",children:[(0,c.jsxs)("div",{className:"header-info",children:[(0,c.jsx)("h2",{children:"Exam Management"}),(0,c.jsx)("p",{children:"Manage exams for all course types (e.g., JEE, NEET, UPSC, Mid-term, Final)"})]}),(0,c.jsx)("div",{style:{display:"flex",gap:"10px"},children:(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>x(!0),children:"Add Exam"})})]}),(0,c.jsx)("div",{className:"filter-section",children:(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{htmlFor:"course-filter",children:"Competitive Course:"}),(0,c.jsxs)("select",{id:"course-filter",value:f,onChange:e=>g(e.target.value),className:"filter-select",children:[(0,c.jsx)("option",{value:"",children:"All Competitive Courses"}),Array.isArray(d)&&d.length>0?d.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id)):(0,c.jsx)("option",{value:"",disabled:!0,children:"No competitive courses available"})]})]})}),p&&(0,c.jsxs)("div",{className:"form-section",children:[(0,c.jsxs)("div",{className:"form-header",children:[(0,c.jsx)("h3",{children:v?"Edit Exam":"Add New Exam"}),(0,c.jsx)("button",{className:"btn btn-outline btn-sm",onClick:U,children:"Cancel"})]}),(0,c.jsxs)("form",{onSubmit:async r=>{r.preventDefault();try{if(h(!0),!j.name||!j.name.trim())return void s({type:"error",message:"Exam name is required",duration:5e3});if(!j.course.id)return void s({type:"error",message:"Course is required",duration:5e3});const r={name:j.name.trim(),description:j.description?j.description.trim():"",courseId:parseInt(j.course.id),displayOrder:j.displayOrder?parseInt(j.displayOrder):0,isActive:j.isActive};console.log("Form data being submitted:",r),v?(await(0,i.FP)(e,v,r),s({type:"success",message:"Exam updated successfully",duration:3e3})):(await(0,i.CB)(e,r),s({type:"success",message:"Exam created successfully",duration:3e3})),x(!1),y(null),N({name:"",description:"",course:{id:""},displayOrder:"",isActive:!0}),I.current.clear(),E.current={data:null,ts:0,courseTypeId:null},f?R(null,f):R()}catch(a){console.error("Error saving exam:",a),s({type:"error",message:"Failed to save exam: ".concat(a.message),duration:5e3})}finally{h(!1)}},className:"master-data-form",children:[(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"name",children:"Exam Name *"}),(0,c.jsx)("input",{type:"text",id:"name",name:"name",value:j.name,onChange:e=>N((0,a.A)((0,a.A)({},j),{},{name:e.target.value})),className:"form-input",required:!0,placeholder:"e.g., JEE Main, NEET, UPSC Prelims"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"course",children:"Course *"}),(0,c.jsxs)("select",{id:"course",name:"course",value:j.course.id,onChange:e=>N((0,a.A)((0,a.A)({},j),{},{course:{id:e.target.value}})),className:"form-input",required:!0,children:[(0,c.jsx)("option",{value:"",children:"Select Competitive Course"}),Array.isArray(d)&&d.length>0?d.map(e=>(0,c.jsx)("option",{value:e.id,children:e.name},e.id)):(0,c.jsx)("option",{value:"",disabled:!0,children:"No competitive courses available - Create a competitive course first"})]})]})]}),(0,c.jsx)("div",{className:"form-row",children:(0,c.jsxs)("div",{className:"form-group full-width",children:[(0,c.jsx)("label",{htmlFor:"description",children:"Description"}),(0,c.jsx)("textarea",{id:"description",name:"description",value:j.description,onChange:e=>N((0,a.A)((0,a.A)({},j),{},{description:e.target.value})),className:"form-input",placeholder:"Brief description of this exam",rows:3})]})}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"displayOrder",children:"Display Order"}),(0,c.jsx)("input",{type:"number",id:"displayOrder",name:"displayOrder",value:j.displayOrder,onChange:e=>N((0,a.A)((0,a.A)({},j),{},{displayOrder:e.target.value})),className:"form-input",placeholder:"e.g., 1, 2, 3",min:"1"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"isActive",children:"Status"}),(0,c.jsxs)("select",{id:"isActive",name:"isActive",value:j.isActive,onChange:e=>N((0,a.A)((0,a.A)({},j),{},{isActive:"true"===e.target.value})),className:"form-input",children:[(0,c.jsx)("option",{value:!0,children:"Active"}),(0,c.jsx)("option",{value:!1,children:"Inactive"})]})]})]}),(0,c.jsxs)("div",{className:"form-actions",children:[(0,c.jsx)("button",{type:"button",className:"btn btn-outline",onClick:U,children:"Cancel"}),(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:m,children:m?"Saving...":v?"Update Exam":"Create Exam"})]})]})]}),(0,c.jsxs)("div",{className:"data-section",children:[(0,c.jsxs)("div",{className:"data-header",children:[(0,c.jsxs)("h3",{children:["Exams (",r.length,")"]}),(0,c.jsx)("div",{className:"data-actions",children:(0,c.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>{f?R(null,f):R()},disabled:m,children:"Refresh"})})]}),m?(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading exams..."})]}):0===r.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"No Exams"}),(0,c.jsx)("h4",{children:"No Exams Found"}),(0,c.jsx)("p",{children:f?"No active exams found for the selected course.":"No active exams have been created yet."}),(0,c.jsx)("p",{className:"text-muted",children:(0,c.jsx)("small",{children:"Note: Only active exams are displayed. Results are ordered by display order and name."})}),(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>x(!0),children:"Create First Exam"})]}):(0,c.jsx)("div",{className:"data-grid",children:r.map(e=>{const s=[{key:"courseTypeName",label:"Course Type",value:e=>{var s,r,a,t;return e.courseTypeName||(null===(s=e.course)||void 0===s?void 0:s.courseTypeName)||((null===(r=e.course)||void 0===r||null===(a=r.courseType)||void 0===a?void 0:a.id)||(null===(t=e.courseType)||void 0===t?void 0:t.id)||e.courseTypeId,"Competitive")}},{key:"courseName",label:"Course",value:e=>{var s;return e.courseName||(e=>{if(!Array.isArray(d))return console.warn("courses is not an array:",d),"Unknown";const s=d.find(s=>s.id===e);return s?s.name:"Unknown"})((null===(s=e.course)||void 0===s?void 0:s.id)||e.courseId)}}];return(0,c.jsx)(l,{item:e,itemType:"exam",onEdit:P,onDelete:M,fields:s},e.id)})})]})]})}}}]);
//# sourceMappingURL=611.634aa0ef.chunk.js.map