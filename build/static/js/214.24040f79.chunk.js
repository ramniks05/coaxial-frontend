"use strict";(self.webpackChunklearning_management_system=self.webpackChunklearning_management_system||[]).push([[214],{214:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var l=t(43),r=t(580),o=t(555);var a=t(821),i=t(712),n=t(579);const c=e=>{let{isOpen:s,onClose:t,fileName:r,filePath:o,fileObject:a,fileType:i="Document Preview"}=e;const c=(0,l.useRef)(null),d=(0,l.useRef)(null),[u,m]=l.useState(!1),[p,h]=(0,l.useState)(null),[f,v]=(0,l.useState)(!1),[b,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{const e=e=>{"Escape"===e.key&&(u?m(!1):t())},l=e=>{("F11"===e.key||e.ctrlKey&&"f"===e.key)&&(e.preventDefault(),y())},r=e=>{u||!c.current||c.current.contains(e.target)||t()};if(s){document.addEventListener("keydown",e),document.addEventListener("keydown",l),document.addEventListener("mousedown",r),document.body.style.overflow="hidden";const s=document.createElement("style");s.id="document-modal-override",s.textContent="\n        body * {\n          transform: none !important;\n          transition: none !important;\n        }\n        body *:hover {\n          transform: none !important;\n          transition: none !important;\n        }\n      ",document.head.appendChild(s)}return()=>{document.removeEventListener("keydown",e),document.removeEventListener("keydown",l),document.removeEventListener("mousedown",r),document.body.style.overflow="unset";const s=document.getElementById("document-modal-override");s&&s.remove()}},[s,t,u]),(0,l.useEffect)(()=>{if(s&&r&&o&&!a){(async()=>{v(!0),x(null);try{let e;e=o.startsWith("/uploads/")?"http://localhost:8080".concat(o):o.startsWith("http://")||o.startsWith("https://")?o:"http://localhost:8080".concat(o),console.log("Fetching server file from:",e);const s=await fetch(e);if(!s.ok)throw new Error("HTTP ".concat(s.status,": ").concat(s.statusText));const t=await s.blob();console.log("Server file fetched successfully, blob size:",t.size);const l=URL.createObjectURL(t);d.current&&URL.revokeObjectURL(d.current),d.current=l,h(l),console.log("Created blob URL for server file:",l)}catch(e){console.error("Error fetching server file:",e),x(e.message)}finally{v(!1)}})()}return()=>{d.current&&(URL.revokeObjectURL(d.current),d.current=null,h(null))}},[s,r,o,a]);const y=()=>{m(!u)},j=(0,l.useMemo)(()=>{var e;if(!r||!s)return null;const t=null===(e=r.split(".").pop())||void 0===e?void 0:e.toLowerCase();return console.log("DocumentPreviewModal - File details:",{fileName:r,extension:t,fileObject:a,filePath:o,serverBlobUrl:p}),"pdf"===t?a?(console.log("Using file object for preview (data entry form)"),URL.createObjectURL(a)):p?(console.log("Using server blob URL for preview (chapter list)"),p):o?(console.log("Using direct server URL for preview (fallback)"),o.startsWith("/uploads/")?"http://localhost:8080".concat(o):o.startsWith("http://")||o.startsWith("https://")?o:"http://localhost:8080".concat(o)):(console.log("No file object, blob URL, or path available"),null):(console.log("File is not PDF, extension:",t),null)},[r,a,o,p,s]);if((0,l.useEffect)(()=>()=>{j&&a&&URL.revokeObjectURL(j)},[j,a]),(0,l.useEffect)(()=>()=>{d.current&&(URL.revokeObjectURL(d.current),d.current=null)},[]),!s)return null;return(0,n.jsx)("div",{className:"document-preview-modal-overlay ".concat(u?"fullscreen":""),children:(0,n.jsxs)("div",{className:"document-preview-modal ".concat(u?"fullscreen":""),ref:c,children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{className:"modal-title",children:r||"Document Preview"}),(0,n.jsxs)("div",{className:"modal-controls",children:[(0,n.jsx)("button",{className:"modal-fullscreen-btn",onClick:y,"aria-label":u?"Exit fullscreen":"Enter fullscreen",title:u?"Exit fullscreen (F11)":"Enter fullscreen (F11)",children:u?"\u2913":"\u2922"}),(0,n.jsx)("button",{className:"modal-close-btn",onClick:t,"aria-label":"Close document preview",title:"Close (Esc)",children:(0,n.jsx)("span",{children:"\u2715"})})]})]}),(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsx)("div",{className:"document-container",children:(()=>{var e;if(!r)return null;const s=null===(e=r.split(".").pop())||void 0===e?void 0:e.toLowerCase();if("pdf"===s){if(f)return(0,n.jsxs)("div",{className:"loading-preview",children:[(0,n.jsx)("div",{className:"loading-spinner",children:"\u23f3"}),(0,n.jsx)("h3",{children:"Loading Document..."}),(0,n.jsx)("p",{children:"Fetching file from server..."})]});if(b)return(0,n.jsxs)("div",{className:"error-preview",children:[(0,n.jsx)("div",{className:"error-icon",children:"\u274c"}),(0,n.jsx)("h3",{children:"Error Loading Document"}),(0,n.jsx)("p",{children:b}),(0,n.jsxs)("div",{className:"preview-actions",children:[(0,n.jsx)("button",{className:"btn btn-outline",onClick:()=>{let e;e=o&&o.startsWith("/uploads/")?"http://localhost:8080".concat(o):"http://localhost:8080/api/admin/master-data/chapters/files/".concat(encodeURIComponent(r)),window.open(e,"_blank")},children:"\ud83d\udd17 Try Direct Link"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:t,children:"Close"})]})]});if(j){console.log("Rendering PDF iframe with URL:",j),console.log("Current window location:",window.location.href),console.log("Expected backend URL should be on port 8080");const e="".concat(j,"#toolbar=0&navpanes=0&scrollbar=0&statusbar=0&messages=0&scrollbar=0&view=FitH");return(0,n.jsx)("iframe",{src:e,width:"100%",height:"100%",style:{border:"none",backgroundColor:u?"#ffffff":"#f5f5f5",width:u?"100vw":"100%",height:u?"calc(100vh - 80px)":"100%",position:u?"absolute":"relative",top:u?"0":"auto",left:u?"0":"auto"},title:r,loading:"lazy",onLoad:()=>console.log("PDF iframe loaded successfully from:",e),onError:s=>console.error("PDF iframe failed to load from:",e,"Error:",s)},j)}return(0,n.jsxs)("div",{className:"no-preview-available",children:[(0,n.jsx)("div",{className:"no-preview-icon",children:"\ud83d\udcc4"}),(0,n.jsx)("h3",{children:"Preview Not Available"}),(0,n.jsx)("p",{children:"File preview is not available. Debug info:"}),(0,n.jsxs)("div",{className:"debug-info",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"File:"})," ",r]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"File Object:"})," ",a?"Available":"Not available"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"File Path:"})," ",o||"Not available"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Server Blob:"})," ",p?"Available":"Not available"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Extension:"})," ",s]})]}),(0,n.jsxs)("div",{className:"preview-options",children:[(0,n.jsx)("p",{children:"To preview this document, you can:"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"\ud83d\udcdd Edit the chapter and use the preview function in the form"}),(0,n.jsx)("li",{children:"\ud83d\udcbe Download the file (if available on server)"}),(0,n.jsx)("li",{children:"\ud83d\udd04 Check browser console for detailed error logs"})]})]}),(0,n.jsxs)("div",{className:"preview-actions",children:[(0,n.jsx)("button",{className:"btn btn-outline",onClick:()=>{let e;e=o&&o.startsWith("/uploads/")?"http://localhost:8080".concat(o):"http://localhost:8080/api/admin/master-data/chapters/files/".concat(encodeURIComponent(r)),console.log("Testing file URL in new tab:",e),window.open(e,"_blank")},children:"\ud83d\udd17 Test URL in New Tab"}),(0,n.jsx)("button",{className:"btn btn-outline",onClick:()=>{let e;e=o&&o.startsWith("/uploads/")?"http://localhost:8080".concat(o):"http://localhost:8080/api/admin/master-data/chapters/files/".concat(encodeURIComponent(r)),console.log("Attempting download from URL:",e),window.open(e,"_blank")},children:"\ud83d\udcbe Try Download"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:t,children:"Close"})]})]})}return(0,n.jsxs)("div",{className:"unsupported-preview",children:[(0,n.jsx)("div",{className:"unsupported-icon",children:"\ud83d\udcc4"}),(0,n.jsx)("h3",{children:"Preview Not Available"}),(0,n.jsx)("p",{children:"Only PDF files are supported for preview."}),(0,n.jsxs)("p",{children:["File: ",(0,n.jsx)("strong",{children:r})]})]})})()}),(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:y,children:u?"Minimize":"Fullscreen"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:t,children:"Close"})]})]})]})})};t(595);const d=e=>{let{isOpen:s,onClose:t,embedUrl:r,watchUrl:o,videoTitle:a="Video Preview"}=e;const i=(0,l.useRef)(null),c=(0,l.useRef)(null);if((0,l.useEffect)(()=>{if(s){document.body.style.overflow="hidden";const e=document.createElement("style");e.id="video-modal-override",e.textContent="\n        body * {\n          transform: none !important;\n          transition: none !important;\n        }\n        body *:hover {\n          transform: none !important;\n          transition: none !important;\n        }\n      ",document.head.appendChild(e),c.current&&r&&(c.current.src=r)}else{document.body.style.overflow="";const e=document.getElementById("video-modal-override");e&&e.remove(),c.current&&(c.current.src="")}return()=>{document.body.style.overflow="";const e=document.getElementById("video-modal-override");e&&e.remove(),c.current&&(c.current.src="")}},[s,r]),(0,l.useEffect)(()=>{const e=e=>{"Escape"===e.key&&s&&t()},l=e=>{i.current&&!i.current.contains(e.target)&&s&&t()};return s&&(document.addEventListener("keydown",e),document.addEventListener("mousedown",l)),()=>{document.removeEventListener("keydown",e),document.removeEventListener("mousedown",l)}},[s,t]),!s)return null;return(0,n.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,padding:"20px",boxSizing:"border-box"},children:(0,n.jsxs)("div",{style:{background:"white",borderRadius:"8px",width:"100%",maxWidth:"900px",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",overflow:"hidden"},ref:i,children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid #e5e7eb",background:"#f9fafb"},children:[(0,n.jsx)("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"#1f2937"},children:a}),(0,n.jsx)("button",{style:{background:"none",border:"none",fontSize:"24px",color:"#6b7280",cursor:"pointer",padding:"4px",lineHeight:1,borderRadius:"4px"},onClick:t,type:"button","aria-label":"Close video preview",children:"\xd7"})]}),(0,n.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,n.jsx)("div",{style:{position:"relative",width:"100%",height:0,paddingBottom:"56.25%",background:"#000",flexShrink:0},children:(0,n.jsx)("iframe",{ref:c,src:r,title:a,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}})}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"12px",padding:"16px 20px",borderTop:"1px solid #e5e7eb",background:"#f9fafb"},children:[(0,n.jsx)("a",{href:o,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"8px 16px",background:"transparent",border:"1px solid #d1d5db",borderRadius:"6px",color:"#374151",textDecoration:"none",fontSize:"14px",fontWeight:500},children:"\ud83d\udd17 Open in YouTube"}),(0,n.jsx)("button",{style:{padding:"8px 16px",background:"#3b82f6",border:"1px solid #3b82f6",borderRadius:"6px",color:"white",fontSize:"14px",fontWeight:500,cursor:"pointer"},onClick:t,type:"button",children:"Close"})]})]})]})})},u={cache:{courses:new Map,classes:new Map,exams:new Map,subjects:new Map,topics:new Map,modules:new Map,chapters:new Map},loading:{courses:!1,classes:!1,exams:!1,subjects:!1,topics:!1,modules:!1,chapters:!1},lastFetch:{courses:new Map,classes:new Map,exams:new Map,subjects:new Map,topics:new Map,modules:new Map,chapters:new Map},abortControllers:{courses:null,classes:null,exams:null,subjects:null,topics:null,modules:null,chapters:null}};var m=t(872);const p=e=>{var s,t,o,i,c,d,p;let{onFiltersChange:h,loading:f}=e;const{token:v}=(0,r.nm)(),{getCourseTypeName:b}=(0,a.o)(),[x,y]=(0,l.useState)([]),{selectedCourseType:j,setSelectedCourseType:g,selectedCourse:C,setSelectedCourse:N,selectedClass:w,setSelectedClass:I,selectedExam:k,setSelectedExam:T,selectedSubject:F,setSelectedSubject:A,selectedTopic:E,setSelectedTopic:S,selectedModule:P,setSelectedModule:L,showActiveOnly:D,setShowActiveOnly:O,filteredCourses:R,filteredClasses:U,filteredExams:M,filteredSubjects:B,filteredTopics:V,filteredModules:q,loadingStates:z,resetFilters:W,isAcademicCourseType:Y,isCompetitiveCourseType:G}=(()=>{const{token:e,addNotification:s}=(0,r.nm)(),{fetchCourses:t,fetchClasses:o,fetchExams:i,fetchSubjects:n,fetchTopicsByLinkage:c,fetchModulesByTopic:d,fetchChaptersByModule:m,isAcademicCourseType:p,isCompetitiveCourseType:h,isProfessionalCourseType:f}=(0,a.o)(),[v,b]=(0,l.useState)(""),[x,y]=(0,l.useState)(""),[j,g]=(0,l.useState)(""),[C,N]=(0,l.useState)(""),[w,I]=(0,l.useState)(""),[k,T]=(0,l.useState)(""),[F,A]=(0,l.useState)(""),[E,S]=(0,l.useState)(!0),[P,L]=(0,l.useState)([]),[D,O]=(0,l.useState)([]),[R,U]=(0,l.useState)([]),[M,B]=(0,l.useState)([]),[V,q]=(0,l.useState)([]),[z,W]=(0,l.useState)([]),[Y,G]=(0,l.useState)([]),_=(0,l.useRef)(null),H=(0,l.useCallback)(function(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join("|")},[]),$=(0,l.useCallback)((e,s)=>{const t=u.lastFetch[e].get(s),l=Date.now();return t&&l-t<2e3},[]),K=(0,l.useCallback)((e,s)=>u.cache[e].get(s)||[],[]),J=(0,l.useCallback)((e,s,t)=>{u.cache[e].set(s,t),u.lastFetch[e].set(s,Date.now())},[]),Z=(0,l.useCallback)(e=>{const s=u.abortControllers[e];s&&s.abort(),u.abortControllers[e]=new AbortController},[]),Q=(0,l.useCallback)(async e=>{if(!e)return L([]),[];const s=H("courses",e),l=K("courses",s);if(l.length>0)return L(l),l;if($("courses",s))return[];try{Z("courses"),u.loading.courses=!0;const l=await t(e)||[];return J("courses",s,l),L(l),l}catch(r){return"AbortError"!==r.name&&console.error("Error fetching courses:",r),L([]),[]}finally{u.loading.courses=!1}},[t,H,K,$,Z,J]),X=(0,l.useCallback)(async(e,s)=>{if(!e||!s)return O([]),[];const t=H("classes",e,s),l=K("classes",t);if(l.length>0)return O(l),l;if($("classes",t))return[];try{Z("classes"),u.loading.classes=!0;const l=await o(e,s)||[];return J("classes",t,l),O(l),l}catch(r){return"AbortError"!==r.name&&console.error("Error fetching classes:",r),O([]),[]}finally{u.loading.classes=!1}},[o,H,K,$,Z,J]),ee=(0,l.useCallback)(async(e,s)=>{if(!e||!s)return U([]),[];const t=H("exams",e,s),l=K("exams",t);if(l.length>0)return U(l),l;if($("exams",t))return[];try{Z("exams"),u.loading.exams=!0;const l=await i(e,s)||[];return J("exams",t,l),U(l),l}catch(r){return"AbortError"!==r.name&&console.error("Error fetching exams:",r),U([]),[]}finally{u.loading.exams=!1}},[i,H,K,$,Z,J]),se=(0,l.useCallback)(async(e,s,t,l)=>{if(!e||!s)return B([]),[];const r=H("subjects",e,s,t,l),o=K("subjects",r);if(o.length>0)return B(o),o;if($("subjects",r))return[];try{Z("subjects"),u.loading.subjects=!0;let o=[];p(e)&&t?o=await n(e,s,t,null,!0):h(e)&&l?o=await n(e,s,null,l,!0):f(e)&&(o=await n(e,s,null,null,!0));const a=o||[];return J("subjects",r,a),B(a),a}catch(a){return"AbortError"!==a.name&&console.error("Error fetching subjects:",a),B([]),[]}finally{u.loading.subjects=!1}},[n,p,h,f,H,K,$,Z,J]),te=(0,l.useCallback)(async(e,s)=>{if(!e||!s)return q([]),[];const t=H("topics",e,s),l=K("topics",t);if(l.length>0)return q(l),l;if($("topics",t))return[];try{Z("topics"),u.loading.topics=!0;const l=await c(parseInt(e),parseInt(s)),r=(Array.isArray(l)?l:(null===l||void 0===l?void 0:l.content)||(null===l||void 0===l?void 0:l.data)||[])||[];return J("topics",t,r),q(r),r}catch(r){return"AbortError"!==r.name&&console.error("Error fetching topics:",r),q([]),[]}finally{u.loading.topics=!1}},[c,H,K,$,Z,J]),le=(0,l.useCallback)(async e=>{if(!e)return W([]),[];const s=H("modules",e,E),t=K("modules",s);if(t.length>0)return W(t),t;if($("modules",s))return[];try{Z("modules"),u.loading.modules=!0;const t=await d(e,E)||[];return J("modules",s,t),W(t),t}catch(l){return"AbortError"!==l.name&&console.error("Error fetching modules:",l),W([]),[]}finally{u.loading.modules=!1}},[d,E,H,K,$,Z,J]),re=(0,l.useCallback)(async e=>{if(!e)return G([]),[];const s=H("chapters",e,E),t=K("chapters",s);if(t.length>0)return G(t),t;if($("chapters",s))return[];try{Z("chapters"),u.loading.chapters=!0;const t=await m(e,E)||[];return J("chapters",s,t),G(t),t}catch(l){return"AbortError"!==l.name&&console.error("Error fetching chapters:",l),G([]),[]}finally{u.loading.chapters=!1}},[m,E,H,K,$,Z,J]);(0,l.useEffect)(()=>(_.current&&clearTimeout(_.current),_.current=setTimeout(async()=>{console.log("\ud83c\udf0d Shared filter effect triggered:",{courseType:v,course:x,class:j,exam:C,subject:w,topic:k,module:F});try{v&&await Q(v),v&&x&&(p(v)&&await X(v,x),h(v)&&await ee(v,x)),v&&x&&await se(v,x,j,C),v&&w&&await te(v,w),k&&await le(k),F&&await re(F),console.log("\u2705 Shared filter data loaded successfully")}catch(e){console.error("\u274c Error in shared filter effect:",e)}},300),()=>{_.current&&clearTimeout(_.current)}),[v,x,j,C,w,k,F,Q,X,ee,se,te,le,re,p,h]),(0,l.useEffect)(()=>()=>{_.current&&clearTimeout(_.current)},[]);const oe=(0,l.useCallback)(()=>{b(""),y(""),g(""),N(""),I(""),T(""),A(""),L([]),O([]),U([]),B([]),q([]),W([]),G([])},[]);return{selectedCourseType:v,setSelectedCourseType:b,selectedCourse:x,setSelectedCourse:y,selectedClass:j,setSelectedClass:g,selectedExam:C,setSelectedExam:N,selectedSubject:w,setSelectedSubject:I,selectedTopic:k,setSelectedTopic:T,selectedModule:F,setSelectedModule:A,showActiveOnly:E,setShowActiveOnly:S,filteredCourses:P,filteredClasses:D,filteredExams:R,filteredSubjects:M,filteredTopics:V,filteredModules:z,filteredChapters:Y,loadingStates:{courses:u.loading.courses,classes:u.loading.classes,exams:u.loading.exams,subjects:u.loading.subjects,topics:u.loading.topics,modules:u.loading.modules,chapters:u.loading.chapters},resetFilters:oe,isAcademicCourseType:p,isCompetitiveCourseType:h,isProfessionalCourseType:f}})();(0,l.useEffect)(()=>{(async()=>{if(v)try{const e=await(0,m.RG)(v);console.log("Raw courseTypes API response (ChapterFilters):",e),console.log("CourseTypes data type:",typeof e),console.log("CourseTypes is array:",Array.isArray(e));let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.content)?s=e.content:e&&Array.isArray(e.data)?s=e.data:e&&e.courseTypes&&Array.isArray(e.courseTypes)?s=e.courseTypes:(console.warn("Unexpected courseTypes data format (ChapterFilters):",e),s=[]),console.log("Processed courseTypes array (ChapterFilters):",s),y(s)}catch(e){console.error("Error loading course types:",e)}})()},[v]),(0,l.useEffect)(()=>{h&&h({courseType:j,course:C,class:w,exam:k,subject:F,topic:E,module:P,showActiveOnly:D})},[j,C,w,k,F,E,P,D,h]);const _=(e,s)=>{switch(e){case"courseType":g(s),N(""),I(""),T(""),A(""),S(""),L("");break;case"course":N(s),I(""),T(""),A(""),S(""),L("");break;case"class":I(s),A(""),S(""),L("");break;case"exam":T(s),A(""),S(""),L("");break;case"subject":A(s),S(""),L("");break;case"topic":S(s),L("");break;case"module":L(s)}};return(0,n.jsxs)("div",{className:"filter-section",children:[(0,n.jsxs)("div",{className:"filter-header",children:[(0,n.jsx)("h4",{children:"Filter Chapters"}),(0,n.jsxs)("div",{className:"filter-header-controls",children:[(0,n.jsxs)("label",{className:"filter-checkbox",children:[(0,n.jsx)("input",{type:"checkbox",checked:D,onChange:e=>O(e.target.checked)}),(0,n.jsx)("span",{children:"Active Only"})]}),(0,n.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>{W()},disabled:f,children:"Clear All Filters"})]})]}),f&&0===x.length?(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("div",{className:"empty-icon",children:"No Chapters"}),(0,n.jsx)("h4",{children:"Loading Course Types..."}),(0,n.jsx)("p",{children:"Please wait while we load the course types"})]}):(0,n.jsxs)("div",{className:"filter-row",children:[(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"course-type-filter",children:"1. Course Type:"}),(0,n.jsxs)("select",{id:"course-type-filter",value:j,onChange:e=>_("courseType",e.target.value),className:"filter-select",children:[(0,n.jsx)("option",{value:"",children:"Select Course Type"}),x.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"course-filter",children:"2. Course:"}),(0,n.jsxs)("select",{id:"course-filter",value:C,onChange:e=>_("course",e.target.value),className:"filter-select",disabled:!j||z.courses,children:[(0,n.jsx)("option",{value:"",children:"Select Course"}),R.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),Y(j)&&(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"class-filter",children:"3. Class:"}),(0,n.jsxs)("select",{id:"class-filter",value:w,onChange:e=>_("class",e.target.value),className:"filter-select",disabled:!C||z.classes,children:[(0,n.jsx)("option",{value:"",children:"Select Class"}),U.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),G(j)&&(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"exam-filter",children:"3. Exam:"}),(0,n.jsxs)("select",{id:"exam-filter",value:k,onChange:e=>_("exam",e.target.value),className:"filter-select",disabled:!C||z.exams,children:[(0,n.jsx)("option",{value:"",children:"Select Exam"}),M.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"subject-filter",children:"4. Subject:"}),(0,n.jsxs)("select",{id:"subject-filter",value:F,onChange:e=>_("subject",e.target.value),className:"filter-select",disabled:!C||z.subjects,children:[(0,n.jsx)("option",{value:"",children:"Select Subject"}),B.map(e=>{const s=e.subjectName||e.name;return(0,n.jsx)("option",{value:e.linkageId||e.id,children:s},e.linkageId||e.id)})]})]}),(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"topic-filter",children:"5. Topic:"}),(0,n.jsxs)("select",{id:"topic-filter",value:E,onChange:e=>_("topic",e.target.value),className:"filter-select",disabled:!F||z.topics,children:[(0,n.jsx)("option",{value:"",children:"Select Topic"}),V.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{className:"filter-group",children:[(0,n.jsx)("label",{htmlFor:"module-filter",children:"6. Module:"}),(0,n.jsxs)("select",{id:"module-filter",value:P,onChange:e=>_("module",e.target.value),className:"filter-select",disabled:!E||z.modules,children:[(0,n.jsx)("option",{value:"",children:"Select Module"}),q.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(j||C||w||k||F||E||P||!D)&&(0,n.jsxs)("div",{className:"active-filters",children:[(0,n.jsx)("strong",{children:"Active Filters:"}),j&&(0,n.jsxs)("span",{className:"filter-tag",children:["Course Type: ",b(j)]}),C&&(0,n.jsxs)("span",{className:"filter-tag",children:["Course: ",null===(s=R.find(e=>e.id==C))||void 0===s?void 0:s.name]}),w&&(0,n.jsxs)("span",{className:"filter-tag",children:["Class: ",null===(t=U.find(e=>e.id==w))||void 0===t?void 0:t.name]}),k&&(0,n.jsxs)("span",{className:"filter-tag",children:["Exam: ",null===(o=M.find(e=>e.id==k))||void 0===o?void 0:o.name]}),F&&(0,n.jsxs)("span",{className:"filter-tag",children:["Subject: ",(null===(i=B.find(e=>e.id==F))||void 0===i?void 0:i.name)||(null===(c=B.find(e=>e.id==F))||void 0===c?void 0:c.subjectName)]}),E&&(0,n.jsxs)("span",{className:"filter-tag",children:["Topic: ",null===(d=V.find(e=>e.id==E))||void 0===d?void 0:d.name]}),P&&(0,n.jsxs)("span",{className:"filter-tag",children:["Module: ",null===(p=q.find(e=>e.id==P))||void 0===p?void 0:p.name]}),!D&&(0,n.jsx)("span",{className:"filter-tag",children:"Including Inactive"})]})]})};var h=t(935);const f=e=>{var s;if(!e)return"\ud83d\udcc4";return{pdf:"\ud83d\udcd5",doc:"\ud83d\udcd8",docx:"\ud83d\udcd8",xls:"\ud83d\udcd7",xlsx:"\ud83d\udcd7",ppt:"\ud83d\udcd9",pptx:"\ud83d\udcd9",txt:"\ud83d\udcc4",rtf:"\ud83d\udcc4",jpg:"\ud83d\uddbc\ufe0f",jpeg:"\ud83d\uddbc\ufe0f",png:"\ud83d\uddbc\ufe0f",gif:"\ud83d\uddbc\ufe0f",bmp:"\ud83d\uddbc\ufe0f",svg:"\ud83d\uddbc\ufe0f",zip:"\ud83d\udddc\ufe0f",rar:"\ud83d\udddc\ufe0f","7z":"\ud83d\udddc\ufe0f",mp3:"\ud83c\udfb5",wav:"\ud83c\udfb5",m4a:"\ud83c\udfb5",mp4:"\ud83c\udfac",avi:"\ud83c\udfac",mov:"\ud83c\udfac",wmv:"\ud83c\udfac",js:"\ud83d\udcbb",html:"\ud83d\udcbb",css:"\ud83d\udcbb",json:"\ud83d\udcbb",xml:"\ud83d\udcbb"}[null===(s=e.split(".").pop())||void 0===s?void 0:s.toLowerCase()]||"\ud83d\udcc4"},v=e=>{var s;if(!e)return"Unknown";const t=null===(s=e.split(".").pop())||void 0===s?void 0:s.toLowerCase();return{pdf:"PDF Document",doc:"Word Document",docx:"Word Document",xls:"Excel Spreadsheet",xlsx:"Excel Spreadsheet",ppt:"PowerPoint Presentation",pptx:"PowerPoint Presentation",txt:"Text File",rtf:"Rich Text File",jpg:"JPEG Image",jpeg:"JPEG Image",png:"PNG Image",gif:"GIF Image",zip:"ZIP Archive",rar:"RAR Archive",mp3:"MP3 Audio",mp4:"MP4 Video"}[t]||"".concat(null===t||void 0===t?void 0:t.toUpperCase()," File")},b=function(e){var s;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["pdf"];if(!e)return{isValid:!1,error:"No file selected"};const l=null===(s=e.split(".").pop())||void 0===s?void 0:s.toLowerCase();return l?t.includes(l)?{isValid:!0,error:null,extension:l,type:v(e)}:{isValid:!1,error:"Only PDF files are allowed. Selected file type: .".concat(l)}:{isValid:!1,error:"Invalid file format"}},x=e=>{if(!e)return null;e=e.trim().replace(/^["']|["']$/g,"");const s=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^"&?\/\s]{11})/,/youtu\.be\/([^"&?\/\s]{11})/,/youtube\.com\/embed\/([^"&?\/\s]{11})/,/youtube\.com\/v\/([^"&?\/\s]{11})/,/youtube\.com\/live\/([^"&?\/\s]{11})/];for(const t of s){const s=e.match(t);if(s)return s[1]}return null},y=e=>null!==x(e),j=function(e){if(!e)return null;const s={default:"default",medium:"mqdefault",high:"hqdefault",maxres:"maxresdefault"}[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"maxres"]||"maxresdefault";return"https://img.youtube.com/vi/".concat(e,"/").concat(s,".jpg")},g=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;const t=(0,o.A)({autoplay:0,controls:1,showinfo:1,rel:0,modestbranding:1},s),l=new URLSearchParams(t);return"https://www.youtube.com/embed/".concat(e,"?").concat(l.toString())},C=e=>{const s=x(e);return s?(e=>e?"https://www.youtube.com/watch?v=".concat(e):null)(s):null},N=e=>{let{onSubmit:s,onCancel:t,editingChapter:i=null,loading:u=!1}=e;const{token:p,addNotification:f}=(0,r.nm)(),{getCourseTypeName:v}=(0,a.o)(),[N,w]=(0,l.useState)([]),[I,k]=(0,l.useState)(""),[T,F]=(0,l.useState)(""),[A,E]=(0,l.useState)(null),[S,P]=(0,l.useState)([]),[L,D]=(0,l.useState)(""),[O,R]=(0,l.useState)({}),[U,M]=(0,l.useState)(!1),[B,V]=(0,l.useState)(null),[q,z]=(0,l.useState)(!1),[W,Y]=(0,l.useState)(null),{formData:G,errors:_,touched:H,handleInputChange:$,handleBlur:K,handleSubmit:J,formFilteredCourses:Z,formFilteredClasses:Q,formFilteredExams:X,formFilteredSubjects:ee,formFilteredTopics:se,formFilteredModules:te,formLoadingStates:le,isAcademicCourseType:re,isCompetitiveCourseType:oe,setFormData:ae,resetForm:ie}=((e,s,t)=>{const{token:i,addNotification:n}=(0,r.nm)(),{fetchCourses:c,fetchClasses:d,fetchExams:u,fetchSubjects:m,fetchTopicsByLinkage:p,fetchModulesByTopic:f,fetchChaptersByModule:v,isAcademicCourseType:b,isCompetitiveCourseType:x,isProfessionalCourseType:y}=(0,a.o)(),{formData:j,errors:g,touched:C,handleInputChange:N,handleBlur:w,validateForm:I,resetForm:k,setFormData:T}=(0,h.d)(e,s),[F,A]=(0,l.useState)([]),[E,S]=(0,l.useState)([]),[P,L]=(0,l.useState)([]),[D,O]=(0,l.useState)([]),[R,U]=(0,l.useState)([]),[M,B]=(0,l.useState)([]),[V,q]=(0,l.useState)([]),[z,W]=(0,l.useState)({courses:!1,classes:!1,exams:!1,subjects:!1,topics:!1,modules:!1,chapters:!1}),Y=(0,l.useRef)({courses:{key:"",timestamp:0},classes:{key:"",timestamp:0},exams:{key:"",timestamp:0},subjects:{key:"",timestamp:0},topics:{key:"",timestamp:0},modules:{key:"",timestamp:0},chapters:{key:"",timestamp:0}}),G=(0,l.useRef)({}),_=(0,l.useCallback)(function(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join("|")},[]),H=(0,l.useCallback)((e,s)=>{const t=Y.current[e],l=Date.now();return t.key===s&&l-t.timestamp<1e3},[]),$=(0,l.useCallback)((e,s)=>{W(t=>(0,o.A)((0,o.A)({},t),{},{[e]:s}))},[]),K=(0,l.useCallback)(e=>{G.current[e]&&G.current[e].abort(),G.current[e]=new AbortController},[]),J=(0,l.useCallback)(async e=>{if(!e)return void A([]);const s=_("form-courses",e);if(!H("courses",s))try{K("courses"),$("courses",!0);const t=await c(e);A(t||[]),Y.current.courses={key:s,timestamp:Date.now()}}catch(t){"AbortError"!==t.name&&(console.error("Error fetching form courses:",t),n({type:"error",message:"Failed to fetch courses",duration:3e3}),A([]))}finally{$("courses",!1)}},[c,_,H,K,$,n]),Z=(0,l.useCallback)(async(e,s)=>{if(!e||!s)return S([]),void L([]);const t=[];if(b(e)){const l=_("form-classes",e,s);H("classes",l)||t.push(d(e,s).then(e=>{S(e||[]),Y.current.classes={key:l,timestamp:Date.now()}}).catch(e=>{"AbortError"!==e.name&&(console.error("Error fetching form classes:",e),S([]))}))}if(x(e)){const l=_("form-exams",e,s);H("exams",l)||t.push(u(e,s).then(e=>{L(e||[]),Y.current.exams={key:l,timestamp:Date.now()}}).catch(e=>{"AbortError"!==e.name&&(console.error("Error fetching form exams:",e),L([]))}))}if(t.length>0){$("classes",!0),$("exams",!0);try{await Promise.all(t)}finally{$("classes",!1),$("exams",!1)}}},[d,u,b,x,_,H,$]),Q=(0,l.useCallback)(async(e,s,t,l)=>{if(!e||!s)return void O([]);const r=_("form-subjects",e,s,t,l);if(!H("subjects",r))try{K("subjects"),$("subjects",!0);let o=[];b(e)&&t?o=await m(e,s,t,null,!0):x(e)&&l?o=await m(e,s,null,l,!0):y(e)&&(o=await m(e,s,null,null,!0)),O(o||[]),Y.current.subjects={key:r,timestamp:Date.now()}}catch(o){"AbortError"!==o.name&&(console.error("Error fetching form subjects:",o),n({type:"error",message:"Failed to fetch subjects",duration:3e3}),O([]))}finally{$("subjects",!1)}},[m,b,x,y,_,H,K,$,n]),X=(0,l.useCallback)(async(e,s)=>{if(!e||!s)return void U([]);const t=_("form-topics",e,s);if(!H("topics",t))try{K("topics"),$("topics",!0);const l=await p(parseInt(e),parseInt(s)),r=Array.isArray(l)?l:(null===l||void 0===l?void 0:l.content)||(null===l||void 0===l?void 0:l.data)||[];U(r||[]),Y.current.topics={key:t,timestamp:Date.now()}}catch(l){"AbortError"!==l.name&&(console.error("Error fetching form topics:",l),n({type:"error",message:"Failed to fetch topics",duration:3e3}),U([]))}finally{$("topics",!1)}},[p,_,H,K,$,n]),ee=(0,l.useCallback)(async e=>{if(!e)return void B([]);const s=_("form-modules",e);if(!H("modules",s))try{K("modules"),$("modules",!0);const t=await f(e,!0);B(t||[]),Y.current.modules={key:s,timestamp:Date.now()}}catch(t){"AbortError"!==t.name&&(console.error("Error fetching form modules:",t),n({type:"error",message:"Failed to fetch modules",duration:3e3}),B([]))}finally{$("modules",!1)}},[f,_,H,K,$,n]),se=(0,l.useCallback)(async e=>{if(!e)return void q([]);const s=_("form-chapters",e);if(!H("chapters",s))try{K("chapters"),$("chapters",!0);const t=await v(e,!0);q(t||[]),Y.current.chapters={key:s,timestamp:Date.now()}}catch(t){"AbortError"!==t.name&&(console.error("Error fetching form chapters:",t),n({type:"error",message:"Failed to fetch chapters",duration:3e3}),q([]))}finally{$("chapters",!1)}},[v,_,H,K,$,n]),te=(0,l.useCallback)(async e=>{e.preventDefault(),j.courseTypeId&&j.courseId?!b(j.courseTypeId)||j.classId?!x(j.courseTypeId)||j.examId?0!==D.length?I()?t&&await t(j):n({type:"error",message:"Please fix the form errors",duration:3e3}):n({type:"error",message:"Please wait for subjects to load or check your selections",duration:3e3}):n({type:"error",message:"Please select an exam for Competitive courses",duration:3e3}):n({type:"error",message:"Please select a class for Academic courses",duration:3e3}):n({type:"error",message:"Please select course type and course first",duration:3e3})},[j,D.length,I,n,b,x,t]),le=(0,l.useCallback)(()=>{k(),A([]),S([]),L([]),O([]),U([]),B([]),q([])},[k]);return(0,l.useEffect)(()=>{J(j.courseTypeId)},[j.courseTypeId,J]),(0,l.useEffect)(()=>{Z(j.courseTypeId,j.courseId)},[j.courseTypeId,j.courseId,Z]),(0,l.useEffect)(()=>{Q(j.courseTypeId,j.courseId,j.classId,j.examId)},[j.courseTypeId,j.courseId,j.classId,j.examId,Q]),(0,l.useEffect)(()=>{X(j.courseTypeId,j.subjectId)},[j.courseTypeId,j.subjectId,X]),(0,l.useEffect)(()=>{ee(j.topicId)},[j.topicId,ee]),(0,l.useEffect)(()=>{se(j.moduleId)},[j.moduleId,se]),(0,l.useEffect)(()=>()=>{Object.values(G.current).forEach(e=>{e&&e.abort()})},[]),{formData:j,errors:g,touched:C,handleInputChange:N,handleBlur:w,validateForm:I,resetForm:le,setFormData:T,handleSubmit:te,formFilteredCourses:F,formFilteredClasses:E,formFilteredExams:P,formFilteredSubjects:D,formFilteredTopics:R,formFilteredModules:M,formFilteredChapters:V,formLoadingStates:z,isAcademicCourseType:b,isCompetitiveCourseType:x,isProfessionalCourseType:y}})({name:"",description:"",displayOrder:"",isActive:!0,courseTypeId:"",courseId:"",classId:"",examId:"",subjectId:"",topicId:"",moduleId:"",youtubeLinks:[],youtubeTitles:[],uploadedFiles:[],uploadedFileTitles:[],uploadedFilePaths:[]},{name:e=>e?"":"Name is required",description:e=>e?"":"Description is required",courseTypeId:e=>e?"":"Course Type is required",subjectId:e=>e?"":"Subject is required",topicId:e=>e?"":"Topic is required",moduleId:e=>e?"":"Module is required"},s);(0,l.useEffect)(()=>{(async()=>{if(p)try{const e=await(0,m.RG)(p);console.log("Raw courseTypes API response (ChapterForm):",e),console.log("CourseTypes data type:",typeof e),console.log("CourseTypes is array:",Array.isArray(e));let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.content)?s=e.content:e&&Array.isArray(e.data)?s=e.data:e&&e.courseTypes&&Array.isArray(e.courseTypes)?s=e.courseTypes:(console.warn("Unexpected courseTypes data format (ChapterForm):",e),s=[]),console.log("Processed courseTypes array (ChapterForm):",s),w(s)}catch(e){console.error("Error loading course types:",e)}})()},[p]),(0,l.useEffect)(()=>{if(i){var e,s,t,l,r,o,a,n,c,d,u,m,p,h,f,v,b,x,y,j,g,C,N,w,I,k,T,F;console.log("Editing chapter:",i),console.log("ChapterForm - Resetting form before populating with editing data"),ie();const A=[],E=[];i.videos&&Array.isArray(i.videos)?(console.log("ChapterForm - Extracting videos from editingChapter.videos:",i.videos),i.videos.forEach((e,s)=>{console.log("Video ".concat(s,":"),e),A.push(e.youtubeLink||""),E.push(e.videoTitle||"")})):i.youtubeLinks&&Array.isArray(i.youtubeLinks)&&(console.log("ChapterForm - Using legacy youtubeLinks:",i.youtubeLinks),i.youtubeLinks.forEach((e,s)=>{var t;A.push(e),E.push((null===(t=i.youtubeTitles)||void 0===t?void 0:t[s])||"Video ".concat(s+1))})),console.log("ChapterForm - Extracted youtubeLinks:",A),console.log("ChapterForm - Extracted youtubeTitles:",E);const S=[],P=[],L=[];i.documents&&Array.isArray(i.documents)&&i.documents.forEach(e=>{S.push(e.fileName||""),P.push(e.documentTitle||""),L.push(e.filePath||"")}),ae({name:i.name||"",description:i.description||"",displayOrder:i.displayOrder||"",isActive:void 0===i.isActive||i.isActive,courseTypeId:(null===(e=i.topic)||void 0===e||null===(s=e.subject)||void 0===s?void 0:s.courseTypeId)||(null===(t=i.module)||void 0===t||null===(l=t.topic)||void 0===l||null===(r=l.subject)||void 0===r?void 0:r.courseTypeId)||"",courseId:(null===(o=i.topic)||void 0===o||null===(a=o.subject)||void 0===a?void 0:a.courseId)||(null===(n=i.module)||void 0===n||null===(c=n.topic)||void 0===c||null===(d=c.subject)||void 0===d?void 0:d.courseId)||"",classId:(null===(u=i.topic)||void 0===u||null===(m=u.subject)||void 0===m?void 0:m.classId)||(null===(p=i.module)||void 0===p||null===(h=p.topic)||void 0===h||null===(f=h.subject)||void 0===f?void 0:f.classId)||"",examId:(null===(v=i.topic)||void 0===v||null===(b=v.subject)||void 0===b?void 0:b.examId)||(null===(x=i.module)||void 0===x||null===(y=x.topic)||void 0===y||null===(j=y.subject)||void 0===j?void 0:j.examId)||"",subjectId:(null===(g=i.topic)||void 0===g||null===(C=g.subject)||void 0===C?void 0:C.subjectId)||(null===(N=i.module)||void 0===N||null===(w=N.topic)||void 0===w||null===(I=w.subject)||void 0===I?void 0:I.id)||"",topicId:(null===(k=i.topic)||void 0===k?void 0:k.id)||(null===(T=i.module)||void 0===T||null===(F=T.topic)||void 0===F?void 0:F.id)||"",moduleId:i.moduleId||"",youtubeLinks:A,youtubeTitles:E,uploadedFiles:S,uploadedFileTitles:P,uploadedFilePaths:L})}},[i]);const ne=()=>{const e=I.trim();if(!e)return void F("YouTube link cannot be empty");if(!y(e))return void F("Invalid YouTube URL format");const s=C(e),t=G.youtubeLinks||[],l=G.youtubeTitles||[];if(console.log("ChapterForm - Adding YouTube link:",{url:e,normalizedUrl:s,currentLinks:t,currentTitles:l,editingChapter:!!i}),t.some(e=>C(e)===s))return F("This video is already added"),void console.log("ChapterForm - Duplicate video detected:",s);x(s);const r="Video ".concat(t.length+1);$("youtubeLinks",[...t,s]),$("youtubeTitles",[...l,r]),k(""),F("")},ce=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=x(s);V({videoId:l,videoUrl:s,embedUrl:e,title:t||"Video Preview"}),M(!0)};return(0,n.jsxs)("div",{className:"form-section",children:[(0,n.jsxs)("div",{className:"form-header",children:[(0,n.jsx)("h3",{children:i?"Edit Chapter":"Create New Chapter"}),(0,n.jsx)("div",{className:"form-header-actions",children:(0,n.jsx)("button",{type:"button",className:"btn btn-outline btn-sm",onClick:t,disabled:u,children:"Cancel"})})]}),(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(0,o.A)((0,o.A)({},G),{},{uploadedFileObjects:O});await s(t)},className:"master-data-form",children:[(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"name",children:"Chapter Name *"}),(0,n.jsx)("input",{type:"text",id:"name",name:"name",value:G.name,onChange:e=>$("name",e.target.value),onBlur:()=>K("name"),className:"form-input ".concat(_.name&&H.name?"error":""),required:!0,placeholder:"e.g., Introduction to Addition, Advanced Concepts"}),_.name&&H.name&&(0,n.jsx)("span",{className:"error-message",children:_.name})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"displayOrder",children:"Display Order"}),(0,n.jsx)("input",{type:"number",id:"displayOrder",name:"displayOrder",value:G.displayOrder,onChange:e=>$("displayOrder",e.target.value),className:"form-input",placeholder:"Order in which chapter appears"})]})]}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group full-width",children:[(0,n.jsx)("label",{htmlFor:"description",children:"Description *"}),(0,n.jsx)("textarea",{id:"description",name:"description",value:G.description,onChange:e=>$("description",e.target.value),onBlur:()=>K("description"),className:"form-textarea ".concat(_.description&&H.description?"error":""),required:!0,rows:3,placeholder:"Describe what this chapter covers..."}),_.description&&H.description&&(0,n.jsx)("span",{className:"error-message",children:_.description})]})}),(0,n.jsxs)("div",{className:"form-row",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"courseTypeId",children:"Course Type *"}),(0,n.jsxs)("select",{id:"courseTypeId",name:"courseTypeId",value:G.courseTypeId,onChange:e=>{$("courseTypeId",e.target.value),$("courseId",""),$("classId",""),$("examId",""),$("subjectId",""),$("topicId",""),$("moduleId","")},onBlur:()=>K("courseTypeId"),className:"form-select ".concat(_.courseTypeId&&H.courseTypeId?"error":""),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select Course Type"}),N.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.courseTypeId&&H.courseTypeId&&(0,n.jsx)("span",{className:"error-message",children:_.courseTypeId})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"courseId",children:"Course *"}),(0,n.jsxs)("select",{id:"courseId",name:"courseId",value:G.courseId,onChange:e=>{$("courseId",e.target.value),$("classId",""),$("examId",""),$("subjectId",""),$("topicId",""),$("moduleId","")},className:"form-select ".concat(_.courseId&&H.courseId?"error":""),required:!0,disabled:!G.courseTypeId||le.courses,children:[(0,n.jsx)("option",{value:"",children:"Select Course"}),Z.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.courseId&&H.courseId&&(0,n.jsx)("span",{className:"error-message",children:_.courseId})]})]}),(0,n.jsxs)("div",{className:"form-row",children:[re(G.courseTypeId)&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"classId",children:"Class *"}),(0,n.jsxs)("select",{id:"classId",name:"classId",value:G.classId,onChange:e=>{$("classId",e.target.value),$("subjectId",""),$("topicId",""),$("moduleId","")},className:"form-select ".concat(_.classId&&H.classId?"error":""),required:!0,disabled:!G.courseId||le.classes,children:[(0,n.jsx)("option",{value:"",children:"Select Class"}),Q.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.classId&&H.classId&&(0,n.jsx)("span",{className:"error-message",children:_.classId})]}),oe(G.courseTypeId)&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"examId",children:"Exam *"}),(0,n.jsxs)("select",{id:"examId",name:"examId",value:G.examId,onChange:e=>{$("examId",e.target.value),$("subjectId",""),$("topicId",""),$("moduleId","")},className:"form-select ".concat(_.examId&&H.examId?"error":""),required:!0,disabled:!G.courseId||le.exams,children:[(0,n.jsx)("option",{value:"",children:"Select Exam"}),X.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.examId&&H.examId&&(0,n.jsx)("span",{className:"error-message",children:_.examId})]})]}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"subjectId",children:"Subject *"}),(0,n.jsxs)("select",{id:"subjectId",name:"subjectId",value:G.subjectId,onChange:e=>{$("subjectId",e.target.value),$("topicId",""),$("moduleId","")},className:"form-select ".concat(_.subjectId&&H.subjectId?"error":""),required:!0,disabled:!G.courseId||le.subjects,children:[(0,n.jsx)("option",{value:"",children:"Select Subject"}),ee.map(e=>(0,n.jsx)("option",{value:e.linkageId||e.id,children:e.subjectName||e.name},e.linkageId||e.id))]}),_.subjectId&&H.subjectId&&(0,n.jsx)("span",{className:"error-message",children:_.subjectId})]})}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"topicId",children:"Topic *"}),(0,n.jsxs)("select",{id:"topicId",name:"topicId",value:G.topicId,onChange:e=>{$("topicId",e.target.value),$("moduleId","")},className:"form-select ".concat(_.topicId&&H.topicId?"error":""),required:!0,disabled:!G.subjectId||le.topics,children:[(0,n.jsx)("option",{value:"",children:"Select Topic"}),se.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.topicId&&H.topicId&&(0,n.jsx)("span",{className:"error-message",children:_.topicId})]})}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"moduleId",children:"Module *"}),(0,n.jsxs)("select",{id:"moduleId",name:"moduleId",value:G.moduleId,onChange:e=>$("moduleId",e.target.value),className:"form-select ".concat(_.moduleId&&H.moduleId?"error":""),required:!0,disabled:!G.topicId||le.modules,children:[(0,n.jsx)("option",{value:"",children:"Select Module"}),te.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),_.moduleId&&H.moduleId&&(0,n.jsx)("span",{className:"error-message",children:_.moduleId})]})}),(0,n.jsxs)("div",{className:"form-section youtube-section",children:[(0,n.jsx)("h4",{children:"\ud83d\udcfa YouTube Video Links"}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group full-width",children:[(0,n.jsx)("label",{htmlFor:"youtube-link",children:"Add YouTube Link"}),(0,n.jsxs)("div",{className:"simple-input-group",children:[(0,n.jsx)("input",{type:"url",id:"youtube-link",value:I,onChange:e=>{const s=e.target.value;k(s),T&&F(""),s.trim()&&!y(s)&&F("Invalid YouTube URL format")},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),ne())},placeholder:"https://www.youtube.com/watch?v=...",className:"form-input ".concat(T?"error":"")}),(0,n.jsx)("button",{type:"button",onClick:ne,className:"btn btn-outline btn-sm",disabled:!I.trim()||!!T,children:"Add"})]}),T&&(0,n.jsx)("small",{className:"form-error",children:T})]})}),G.youtubeLinks&&G.youtubeLinks.length>0&&(0,n.jsxs)("div",{className:"simple-video-list",children:[(0,n.jsxs)("h5",{children:["Added Videos (",G.youtubeLinks.length,")"]}),G.youtubeLinks.map((e,s)=>{const t=(G.youtubeTitles||[])[s]||"Video ".concat(s+1);return(0,n.jsxs)("div",{className:"simple-video-item",children:[(0,n.jsxs)("div",{className:"video-thumbnail-small",onClick:()=>ce(g(x(e)),e,t),children:[(0,n.jsx)("img",{src:j(x(e),"default"),alt:t,onError:e=>{e.target.style.display="none"}}),(0,n.jsx)("div",{className:"play-overlay-small",children:(0,n.jsx)("span",{children:"\u25b6\ufe0f"})})]}),(0,n.jsxs)("div",{className:"video-info-small",children:[(0,n.jsx)("div",{className:"video-title-small",children:(0,n.jsx)("strong",{children:t})}),(0,n.jsx)("div",{className:"video-url-small",title:e,children:e}),(0,n.jsxs)("div",{className:"video-actions-small",children:[(0,n.jsx)("button",{type:"button",onClick:()=>ce(g(x(e)),e,t),className:"btn btn-outline btn-xs",title:"Preview video",children:"Preview"}),(0,n.jsx)("button",{type:"button",onClick:()=>((e,s)=>{const t=prompt("Edit Video Title:",s);if(t&&t.trim()){const s=[...G.youtubeTitles||[]];s[e]=t.trim(),$("youtubeTitles",s)}})(s,t),className:"btn btn-outline btn-xs",title:"Edit title",children:"Edit Title"}),(0,n.jsx)("button",{type:"button",onClick:()=>((e,s)=>{const t=prompt("Edit YouTube URL:",s);if(t&&t.trim()&&y(t.trim())){const s=C(t.trim()),l=G.youtubeLinks||[];if(l.filter((s,t)=>t!==e).some(e=>C(e)===s))return void F("This video is already added");F("");const r=[...l];r[e]=s,$("youtubeLinks",r)}})(s,e),className:"btn btn-outline btn-xs",title:"Edit URL",children:"Edit URL"}),(0,n.jsx)("button",{type:"button",onClick:()=>(e=>{const s=G.youtubeLinks||[],t=G.youtubeTitles||[];$("youtubeLinks",s.filter((s,t)=>t!==e)),$("youtubeTitles",t.filter((s,t)=>t!==e))})(s),className:"btn btn-danger btn-xs",title:"Remove video",children:"Remove"})]})]})]},"".concat(e,"-").concat(s))})]})]}),(0,n.jsxs)("div",{className:"form-section document-section",children:[(0,n.jsx)("h4",{children:"\ud83d\udcd5 PDF Documents"}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsxs)("div",{className:"form-group full-width",children:[(0,n.jsx)("label",{children:"Upload PDF Document"}),(0,n.jsxs)("div",{className:"pdf-upload-container",children:[(0,n.jsx)("input",{type:"file",id:"pdf-upload",accept:".pdf",onChange:e=>{const s=e.target.files[0];if(s){const t=b(s.name);if(!t.isValid)return void D(t.error);const l=G.uploadedFiles||[];if(l.includes(s.name))return void D('File "'.concat(s.name,'" is already uploaded'));D("");const r=G.uploadedFileTitles||[],a=G.uploadedFilePaths||[],i=[...l,s.name],n=[...r,s.name.replace(/\.[^/.]+$/,"")],c=[...a,""];$("uploadedFiles",i),$("uploadedFileTitles",n),$("uploadedFilePaths",c),R(e=>(0,o.A)((0,o.A)({},e),{},{[s.name]:s})),e.target.value=""}},style:{display:"none"}}),(0,n.jsx)("button",{type:"button",onClick:()=>document.getElementById("pdf-upload").click(),className:"btn btn-primary pdf-upload-btn",disabled:u,children:"Choose PDF File"}),(0,n.jsx)("span",{className:"upload-hint",children:"or drag and drop PDF here"})]}),L&&(0,n.jsx)("small",{className:"form-error",children:L}),(0,n.jsx)("small",{className:"form-help",children:"Only PDF files are supported. Maximum file size: 10MB"})]})}),G.uploadedFiles&&G.uploadedFiles.length>0&&(0,n.jsxs)("div",{className:"simple-document-list",children:[(0,n.jsxs)("h5",{children:["\ud83d\udcd5 PDF Documents (",G.uploadedFiles.length,")"]}),G.uploadedFiles.map((e,s)=>{const t=(G.uploadedFileTitles||[])[s]||e.replace(/\.[^/.]+$/,"");return(0,n.jsxs)("div",{className:"simple-document-item",children:[(0,n.jsx)("div",{className:"document-icon",children:"\ud83d\udcc4"}),(0,n.jsxs)("div",{className:"document-info-small",children:[(0,n.jsx)("div",{className:"document-title-small",children:(0,n.jsx)("strong",{children:t})}),(0,n.jsx)("div",{className:"document-filename-small",title:e,children:e}),(0,n.jsxs)("div",{className:"document-actions-small",children:[(0,n.jsx)("button",{type:"button",onClick:()=>function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=null;i&&G.uploadedFilePaths&&G.uploadedFilePaths[s]&&(t=G.uploadedFilePaths[s]);const l=O[e];Y({fileName:e,filePath:t,fileObject:l}),z(!0)}(e,s),className:"btn btn-outline btn-xs",title:"Preview document",children:"Preview"}),(0,n.jsx)("button",{type:"button",onClick:()=>((e,s)=>{const t=prompt("Edit Document Title:",s);if(t&&t.trim()){const s=[...G.uploadedFileTitles||[]];s[e]=t.trim(),$("uploadedFileTitles",s)}})(s,t),className:"btn btn-outline btn-xs",title:"Edit title",children:"Edit Title"}),(0,n.jsx)("button",{type:"button",onClick:()=>(e=>{const s=G.uploadedFiles||[],t=G.uploadedFileTitles||[],l=G.uploadedFilePaths||[],r=s[e],a=s.filter((s,t)=>t!==e),i=t.filter((s,t)=>t!==e),n=l.filter((s,t)=>t!==e);$("uploadedFiles",a),$("uploadedFileTitles",i),$("uploadedFilePaths",n),R(e=>{const s=(0,o.A)({},e);return delete s[r],s})})(s),className:"btn btn-danger btn-xs",title:"Remove document",children:"Remove"})]})]})]},"".concat(e,"-").concat(s))})]})]}),(0,n.jsx)("div",{className:"form-row",children:(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{className:"checkbox-label",children:[(0,n.jsx)("input",{type:"checkbox",name:"isActive",checked:G.isActive,onChange:e=>$("isActive",e.target.checked),className:"checkbox-input"}),(0,n.jsx)("span",{className:"checkbox-text",children:"Active"})]})})}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:u,children:u?"Saving...":i?"Update Chapter":"Create Chapter"}),(0,n.jsx)("button",{type:"button",className:"btn btn-outline",onClick:t,disabled:u,children:"Cancel"})]})]}),(0,n.jsx)(d,{isOpen:U,onClose:()=>{M(!1),V(null)},embedUrl:null===B||void 0===B?void 0:B.embedUrl,watchUrl:null===B||void 0===B?void 0:B.videoUrl,videoTitle:(null===B||void 0===B?void 0:B.title)||"Video Preview"}),(0,n.jsx)(c,{isOpen:q,onClose:()=>{z(!1),Y(null)},fileName:null===W||void 0===W?void 0:W.fileName,filePath:null===W||void 0===W?void 0:W.filePath,fileObject:null===W||void 0===W?void 0:W.fileObject,fileType:"Document Preview"})]})},w=e=>{let{chapter:s,onEdit:t,onDelete:r,onPreviewVideo:o,onPreviewDocument:a}=e;const[i,c]=(0,l.useState)(!1),{id:d,name:u,description:m,displayOrder:p,isActive:h,createdAt:v,updatedAt:b,createdByName:y,updatedByName:C,moduleName:N,subjectName:w,videos:I=[],documents:k=[],youtubeLinks:T=[],uploadedFiles:F=[]}=s;return(0,n.jsxs)("div",{className:"chapter-list-card",children:[(0,n.jsxs)("div",{className:"card-header",children:[(0,n.jsxs)("div",{className:"card-title",children:[(0,n.jsx)("h4",{children:u}),(0,n.jsxs)("div",{className:"card-badges",children:[(0,n.jsx)("span",{className:"status-badge ".concat(h?"active":"inactive"),children:h?"Active":"Inactive"}),p&&(0,n.jsxs)("span",{className:"order-badge",children:["Order: ",p]})]})]}),(0,n.jsxs)("div",{className:"card-actions",children:[(0,n.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>t(s),title:"Edit Chapter",children:"\u270f\ufe0f Edit"}),(0,n.jsx)("button",{className:"btn btn-danger btn-xs",onClick:()=>r(d),title:"Delete Chapter",children:"\ud83d\uddd1\ufe0f Delete"})]})]}),(0,n.jsxs)("div",{className:"card-content",children:[m&&(0,n.jsx)("p",{className:"description",children:m}),(0,n.jsxs)("div",{className:"multimedia-summary",children:[(0,n.jsxs)("div",{className:"summary-stats",children:[(I.length>0||T.length>0)&&(0,n.jsxs)("div",{className:"stat-item",children:[(0,n.jsx)("span",{className:"stat-icon",children:"\ud83c\udfac"}),(0,n.jsxs)("span",{className:"stat-text",children:["Videos (",I.length||T.length,")"]})]}),(k.length>0||F.length>0)&&(0,n.jsxs)("div",{className:"stat-item",children:[(0,n.jsx)("span",{className:"stat-icon",children:"\ud83d\udcc4"}),(0,n.jsxs)("span",{className:"stat-text",children:["Documents (",k.length||F.length,")"]})]})]}),(I.length>0||T.length>0||k.length>0||F.length>0)&&(0,n.jsx)("button",{className:"btn btn-link btn-xs",onClick:()=>{c(!i)},children:i?"Hide Details":"Show Details"})]}),i&&(0,n.jsxs)("div",{className:"multimedia-details",children:[(I.length>0||T.length>0)&&(0,n.jsxs)("div",{className:"media-section",children:[(0,n.jsx)("h5",{children:"\ud83c\udfac YouTube Videos"}),(0,n.jsx)("div",{className:"video-thumbnails",children:(I.length>0?I:T).map((e,s)=>{var t;let l,r;"string"===typeof e?(l=e,r="Video ".concat(s+1)):(l=e.youtubeLink,r=e.videoTitle||"Video ".concat(s+1));const a=(null===(t=l)||void 0===t?void 0:t.trim().replace(/^["']|["']$/g,""))||"",i=x(a),c=i?j(i):null;return(0,n.jsxs)("div",{className:"video-thumbnail",onClick:()=>((e,s)=>{var t;let l,r;"string"===typeof e?(l=e,r="Video ".concat(s+1)):(l=e.youtubeLink,r=e.videoTitle||"Video ".concat(s+1));const a=(null===(t=l)||void 0===t?void 0:t.trim().replace(/^["']|["']$/g,""))||"",i=x(a);if(!i)return void console.error("Invalid YouTube URL:",a);const n=g(i);console.log("ChapterListCard - Video preview requested:",{originalUrl:l,cleanUrl:a,videoId:i,embedUrl:n,videoTitle:r,chapterId:d,chapterName:u,videoObject:e}),o({videoUrl:a,embedUrl:n,watchUrl:a,index:s,title:r})})(e,s),title:"Click to preview video",children:[(0,n.jsx)("img",{src:c,alt:r,loading:"lazy"}),(0,n.jsx)("div",{className:"play-overlay",children:(0,n.jsx)("span",{children:"\u25b6\ufe0f"})}),(0,n.jsx)("div",{className:"video-info",children:(0,n.jsx)("span",{children:r})})]},s)})})]}),(k.length>0||F.length>0)&&(0,n.jsxs)("div",{className:"media-section",children:[(0,n.jsx)("h5",{children:"\ud83d\udcc4 Documents"}),(0,n.jsx)("div",{className:"document-list",children:(k.length>0?k:F).map((e,s)=>{let t,l;var r;"string"===typeof e?(t=e.split("/").pop(),l=t):(t=e.fileName||(null===(r=e.filePath)||void 0===r?void 0:r.split("/").pop())||"Document ".concat(s+1),l=e.documentTitle||t);const o=f(t);return(0,n.jsxs)("div",{className:"document-item",onClick:()=>((e,s)=>{let t,l,r;var o;"string"===typeof e?(t=e.split("/").pop(),l=e,r=t):(t=e.fileName||(null===(o=e.filePath)||void 0===o?void 0:o.split("/").pop())||"Document ".concat(s+1),l=e.filePath||e.fileName,r=e.documentTitle||t),console.log("ChapterListCard - Document preview requested:",{fileName:t,filePath:l,documentTitle:r,chapterId:d,chapterName:u,documentObject:e,hasFilePath:!!l,filePathType:typeof l}),a({fileName:t,filePath:l,fileObject:null,index:s,title:r})})(e,s),title:"Click to preview document",children:[(0,n.jsxs)("div",{className:"document-icon",children:[(0,n.jsx)("span",{className:"file-icon",children:o}),(0,n.jsx)("div",{className:"preview-overlay",children:(0,n.jsx)("span",{children:"\ud83d\udcc4"})})]}),(0,n.jsxs)("div",{className:"document-info",children:[(0,n.jsx)("div",{className:"document-name",title:l,children:t}),e.documentTitle&&e.documentTitle!==t&&(0,n.jsx)("div",{className:"document-title",title:e.documentTitle,children:e.documentTitle})]})]},s)})})]})]})]}),(0,n.jsxs)("div",{className:"card-footer",children:[(0,n.jsxs)("div",{className:"footer-info",children:[(0,n.jsxs)("small",{className:"text-muted",children:["Created: ",new Date(v).toLocaleDateString(),y&&" by ".concat(y)]}),b&&b!==v&&(0,n.jsxs)("small",{className:"text-muted",children:["Updated: ",new Date(b).toLocaleDateString(),C&&" by ".concat(C)]})]}),(0,n.jsxs)("div",{className:"footer-meta",children:[N&&(0,n.jsxs)("small",{className:"meta-item",children:["\ud83d\udce6 ",N]}),w&&(0,n.jsxs)("small",{className:"meta-item",children:["\ud83d\udcda ",w]})]})]})]})},I=e=>{let{filters:s,onEdit:t,onDelete:o,onPreviewVideo:i,onPreviewDocument:c,loading:d=!1,chapters:u=[]}=e;const{token:p,addNotification:h}=(0,r.nm)(),{getCourseTypeName:f,getCourseName:v}=(0,a.o)(),[b,x]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{if(p)try{const e=await(0,m.RG)(p);console.log("Raw courseTypes API response (ChapterList):",e),console.log("CourseTypes data type:",typeof e),console.log("CourseTypes is array:",Array.isArray(e));let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.content)?s=e.content:e&&Array.isArray(e.data)?s=e.data:e&&e.courseTypes&&Array.isArray(e.courseTypes)?s=e.courseTypes:(console.warn("Unexpected courseTypes data format (ChapterList):",e),s=[]),console.log("Processed courseTypes array (ChapterList):",s),x(s)}catch(e){console.error("Error loading course types:",e)}})()},[p]);const y=e=>{var s,t,l,r;return e.courseTypeName||(null===(s=e.course)||void 0===s?void 0:s.courseTypeName)||f((null===(t=e.course)||void 0===t||null===(l=t.courseType)||void 0===l?void 0:l.id)||(null===(r=e.courseType)||void 0===r?void 0:r.id)||e.courseTypeId)},j=e=>{var s;return e.courseName||v((null===(s=e.course)||void 0===s?void 0:s.id)||e.courseId)},g=(()=>{const e={};return u.forEach(s=>{const t=y(s);e[t]||(e[t]=[]),e[t].push(s)}),e})(),C=Object.keys(g).sort();return d?(0,n.jsxs)("div",{className:"loading-container",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("p",{children:"Loading chapters..."})]}):u&&0!==u.length?(0,n.jsxs)("div",{className:"data-section",children:[(0,n.jsxs)("div",{className:"data-header",children:[(0,n.jsxs)("h4",{children:["Chapters (",u.length,")"]}),(0,n.jsx)("div",{className:"data-header-actions",children:(0,n.jsxs)("span",{className:"data-count",children:["Showing ",u.length," chapter",1!==u.length?"s":""]})})]}),(0,n.jsx)("div",{className:"chapters-by-type",children:C.map(e=>(0,n.jsxs)("div",{className:"chapter-type-section",children:[(0,n.jsx)("div",{className:"section-header",children:(0,n.jsxs)("h4",{children:[e," (",g[e].length,")"]})}),(0,n.jsx)("div",{className:"data-grid",children:g[e].map(e=>(0,n.jsx)(w,{chapter:e,onEdit:()=>t(e),onDelete:()=>o(e),onPreviewVideo:i,onPreviewDocument:c,getCourseTypeName:y,getCourseName:j},e.id))})]},e))})]}):(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("div",{className:"empty-icon",children:"No Chapters"}),(0,n.jsx)("h4",{children:"No chapters found"}),(0,n.jsx)("p",{children:Object.keys(s).some(e=>s[e]&&""!==s[e])?"No chapters match your current filters. Try adjusting your search criteria.":"Start by creating your first chapter using the form above."})]})},k=()=>{const{token:e,addNotification:s}=(0,r.nm)(),{getCourseTypeName:u}=(0,a.o)(),{executeApiCall:m}=(()=>{const{token:e,addNotification:s}=(0,r.nm)(),t=(0,l.useRef)(new Map),a=(0,l.useRef)(new Map),i=(0,l.useRef)(new Map),n=(0,l.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=Object.keys(s).sort().map(e=>"".concat(e,"=").concat(s[e])).join("&");return"".concat(e,"?").concat(t)},[]),c=(0,l.useCallback)(e=>{const s=Date.now(),t=i.current.get(e);return!!(t&&s-t.timestamp<1e3)},[]),d=(0,l.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;const l=t.current.get(e);return l&&Date.now()-l.timestamp<s?l.data:null},[]),u=(0,l.useCallback)((e,s)=>{t.current.set(e,{data:s,timestamp:Date.now()})},[]),m=(0,l.useCallback)(e=>{const s=a.current.get(e);s&&(s.abort(),a.current.delete(e))},[]),p=(0,l.useCallback)(async function(t){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{useCache:p=!0,cacheTTL:h=3e4,showError:f=!0,errorMessage:v="API call failed"}=r,b=n(t.name||"api",l);if(p){const e=d(b,h);if(e)return e}if(c(b))return console.log("Skipping duplicate API call: ".concat(b)),null;i.current.set(b,{timestamp:Date.now()}),m(b);const x=new AbortController;a.current.set(b,x);try{const s=await t(e,(0,o.A)((0,o.A)({},l),{},{signal:x.signal}));return p&&u(b,s),i.current.delete(b),a.current.delete(b),s}catch(y){if(i.current.delete(b),a.current.delete(b),"AbortError"===y.name)return console.log("API call aborted: ".concat(b)),null;throw console.error("API call failed: ".concat(b),y),f&&s({type:"error",message:"".concat(v,": ").concat(y.message||"Unknown error"),duration:5e3}),y}},[e,n,d,u,c,m,s]),h=(0,l.useCallback)(async e=>{const t=e.map(e=>{let{apiFunction:s,params:t={},options:l={}}=e;return p(s,t,(0,o.A)((0,o.A)({},l),{},{showError:!1})).catch(e=>(console.error("Parallel API call failed: ".concat(s.name),e),{error:e.message}))});try{return await Promise.all(t)}catch(l){return console.error("Parallel API calls failed:",l),s({type:"error",message:"Some API calls failed",duration:5e3}),[]}},[p,s]),f=(0,l.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e)for(const[s]of t.current)s.includes(e)&&t.current.delete(s);else t.current.clear()},[]),v=(0,l.useCallback)(()=>{for(const[e,s]of a.current)s.abort(),a.current.delete(e);i.current.clear()},[]),b=(0,l.useCallback)(()=>({cacheSize:t.current.size,pendingRequests:i.current.size,activeAbortControllers:a.current.size}),[]);return{executeApiCall:p,executeParallelApiCalls:h,clearCache:f,abortAllRequests:v,getCacheStats:b,createCacheKey:n,getCachedResponse:d,shouldSkipRequest:c}})(),[h,f]=(0,l.useState)(!1),[v,b]=(0,l.useState)(!1),[x,y]=(0,l.useState)(null),[j,g]=(0,l.useState)([]),[C,w]=(0,l.useState)({}),[k,T]=(0,l.useState)(!1),[F,A]=(0,l.useState)(null),[E,S]=(0,l.useState)(!1),[P,L]=(0,l.useState)(null),D=(0,l.useCallback)(async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e)try{let e;if(f(!0),console.log("=== LOADING CHAPTERS ==="),console.log("Filters:",s),s.module)console.log("Loading chapters for module:",s.module),e=await m(i.CE,{moduleId:s.module,showActiveOnly:!1!==s.showActiveOnly},{useCache:!0,cacheTTL:3e4,errorMessage:"Failed to load chapters"});else{console.log("Loading all chapters (no module filter)");const{getChaptersCombinedFilter:l}=await Promise.resolve().then(t.bind(t,712));e=await m(l,{active:!1!==s.showActiveOnly,page:0,size:100,sortBy:"createdAt",sortDir:"desc"},{useCache:!0,cacheTTL:3e4,errorMessage:"Failed to load chapters"})}if(e){var l,r;const s=Array.isArray(e)?e:(null===(l=e)||void 0===l?void 0:l.content)||(null===(r=e)||void 0===r?void 0:r.data)||[];console.log("Chapters loaded:",s.length,"items"),g(s||[])}}catch(o){console.error("Error loading chapters:",o),g([])}finally{f(!1)}},[e,m]);(0,l.useEffect)(()=>{console.log("ChapterManagementNew mounted - loading all chapters"),D({showActiveOnly:!0})},[D]);const O=(0,l.useCallback)(e=>{w(e),D(e)},[D]),R=(0,l.useCallback)(async t=>{if(e)try{f(!0);const e={name:t.name.trim(),description:t.description.trim(),moduleId:parseInt(t.moduleId),displayOrder:t.displayOrder?parseInt(t.displayOrder):null,isActive:!1!==t.isActive,youtubeLinks:t.youtubeLinks||[],youtubeTitles:t.youtubeTitles||[],uploadedFiles:t.uploadedFiles||[],uploadedFileTitles:t.uploadedFileTitles||[]};let l;if(t.uploadedFileObjects&&Object.keys(t.uploadedFileObjects).length>0&&(e.uploadedFileObjects=t.uploadedFileObjects),console.log("Submit data for update:",e),console.log("Editing chapter:",x),x){const t=async(e,s)=>await(0,i.bd)(e,s.id,s.chapterData);l=await m(t,{id:x.id,chapterData:e},{errorMessage:"Failed to update chapter"}),s({type:"success",message:"Chapter updated successfully",duration:3e3})}else l=await m(i.gC,e,{errorMessage:"Failed to create chapter"}),s({type:"success",message:"Chapter created successfully",duration:3e3});l&&(b(!1),y(null),D(C))}catch(l){console.error("Error submitting chapter:",l)}finally{f(!1)}},[e,x,m,s,D,C]),U=(0,l.useCallback)(e=>{y(e),b(!0)},[]),M=(0,l.useCallback)(async t=>{if(e&&window.confirm('Are you sure you want to delete the chapter "'.concat(t.name,'"?')))try{f(!0),await m(i.DI,{id:t.id},{errorMessage:"Failed to delete chapter"}),s({type:"success",message:"Chapter deleted successfully",duration:3e3}),D(C)}catch(l){console.error("Error deleting chapter:",l)}finally{f(!1)}},[e,m,s,D,C]),B=(0,l.useCallback)(()=>{b(!1),y(null)},[]),V=(0,l.useCallback)(()=>{y(null),b(!0)},[]),q=(0,l.useCallback)(e=>{console.log("Preview video:",e),A(e),T(!0)},[]),z=(0,l.useCallback)(e=>{console.log("ChapterManagementNew - Preview document called with:",e),console.log("Document preview data details:",{fileName:null===e||void 0===e?void 0:e.fileName,filePath:null===e||void 0===e?void 0:e.filePath,fileObject:null===e||void 0===e?void 0:e.fileObject,title:null===e||void 0===e?void 0:e.title,hasFilePath:!(null===e||void 0===e||!e.filePath),filePathType:typeof(null===e||void 0===e?void 0:e.filePath)}),L(e),S(!0)},[]),W=(0,l.useCallback)(()=>{T(!1),A(null)},[]),Y=(0,l.useCallback)(()=>{S(!1),L(null)},[]);return(0,n.jsxs)("div",{className:"chapter-management",children:[(0,n.jsxs)("div",{className:"component-header",children:[(0,n.jsxs)("div",{className:"header-content",children:[(0,n.jsx)("h2",{children:"Chapter Management"}),(0,n.jsx)("p",{children:"Manage chapters for your courses, organized by modules"})]}),(0,n.jsx)("div",{className:"header-actions",children:(0,n.jsx)("button",{className:"btn btn-primary",onClick:V,disabled:h,children:"Create Chapter"})})]}),(0,n.jsx)(p,{onFiltersChange:O,loading:h}),v&&(0,n.jsx)(N,{onSubmit:R,onCancel:B,editingChapter:x,loading:h}),(0,n.jsx)(I,{filters:C,chapters:j,onEdit:U,onDelete:M,onPreviewVideo:q,onPreviewDocument:z,loading:h}),(0,n.jsx)(d,{isOpen:k,onClose:W,embedUrl:null===F||void 0===F?void 0:F.embedUrl,watchUrl:null===F||void 0===F?void 0:F.watchUrl,videoTitle:null===F||void 0===F?void 0:F.title}),(0,n.jsx)(c,{isOpen:E,onClose:Y,fileName:null===P||void 0===P?void 0:P.fileName,filePath:null===P||void 0===P?void 0:P.filePath,fileObject:null===P||void 0===P?void 0:P.fileObject,fileType:"Document Preview"})]})}}}]);
//# sourceMappingURL=214.24040f79.chunk.js.map