"use strict";(self.webpackChunklearning_management_system=self.webpackChunklearning_management_system||[]).push([[469],{469:(e,s,r)=>{r.r(s),r.d(s,{default:()=>d});var a=r(555),t=r(43),o=r(580),n=r(872),c=r(712),i=(r(595),r(579));const l=e=>{let{item:s,itemType:r="item",onEdit:a,onDelete:t,fields:o=[],badges:n=[]}=e;const c=()=>s.description,l=()=>s.createdByName;return(0,i.jsxs)("div",{className:"data-card",children:[(0,i.jsxs)("div",{className:"card-header",children:[(0,i.jsxs)("div",{className:"card-title",children:[(0,i.jsx)("h4",{children:(()=>{switch(r){case"subject":return s.subjectName||s.name;case"topic":return s.topicName||s.name;default:return s.name}})()}),(0,i.jsxs)("div",{className:"card-badges",children:[(0,i.jsx)("span",{className:"status-badge ".concat(s.isActive?"active":"inactive"),children:s.isActive?"Active":"Inactive"}),n.map(e=>{const{key:r,label:a,value:t,condition:o,style:n,icon:c}=e;if(o&&!o(s))return null;const l=t||s[r];return l?(0,i.jsxs)("span",{className:"structure-badge",style:n,children:[c," ",l]},r):null})]})]}),(0,i.jsxs)("div",{className:"card-actions",children:[(0,i.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>{a&&a(s)},children:"Edit"}),(0,i.jsx)("button",{className:"btn btn-danger btn-xs",onClick:()=>{t&&t(s.id)},children:"Delete"})]})]}),(0,i.jsxs)("div",{className:"card-content",children:[c()&&(0,i.jsx)("p",{className:"description",children:c()}),o.map(e=>{const{key:r,label:a,value:t,condition:o}=e;if(o&&!o(s))return null;const n="function"===typeof t?t(s):t||s[r];return n?(0,i.jsxs)("p",{children:[(0,i.jsxs)("strong",{children:[a,":"]})," ",n]},r):null})]}),(0,i.jsx)("div",{className:"card-footer",children:(0,i.jsxs)("small",{className:"text-muted",children:["Created: ",new Date(s.createdAt).toLocaleDateString(),l()&&(0,i.jsxs)("span",{children:[" by ",l()]})]})})]})},d=()=>{const{token:e,addNotification:s}=(0,o.nm)(),[r,d]=(0,t.useState)([]),[u,p]=(0,t.useState)([]),[m,y]=(0,t.useState)(!1),[h,g]=(0,t.useState)(!1),[f,v]=(0,t.useState)(null),[x,j]=(0,t.useState)(""),[b,A]=(0,t.useState)({name:"",description:"",courseType:{id:""},displayOrder:"",isActive:!0}),N=(0,t.useRef)(!1),C=(0,t.useRef)(!1),T=(0,t.useRef)(e);(0,t.useEffect)(()=>{T.current=e},[e]),(0,t.useEffect)(()=>{if(N.current||!T.current)return;(async()=>{try{y(!0);const e=await(0,n.RG)(T.current);console.log("Raw courseTypes API response:",e),console.log("CourseTypes data type:",typeof e),console.log("CourseTypes is array:",Array.isArray(e));let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.content)?s=e.content:e&&Array.isArray(e.data)?s=e.data:e&&e.courseTypes&&Array.isArray(e.courseTypes)?s=e.courseTypes:(console.warn("Unexpected courseTypes data format:",e),s=[]),console.log("Processed courseTypes array:",s),p(s),N.current=!0}catch(e){console.error("Error fetching course types:",e),p([]),s({type:"error",message:"Failed to fetch course types: ".concat(e.message),duration:5e3})}finally{y(!1)}})()},[]),(0,t.useEffect)(()=>{if(!T.current)return;(async()=>{try{y(!0);const e=await(0,n.bh)(T.current,x,0,10,"createdAt","desc");console.log("Raw courses API response:",e),console.log("Courses data type:",typeof e),console.log("Courses is array:",Array.isArray(e));let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.content)?s=e.content:e&&Array.isArray(e.data)?s=e.data:e&&e.courses&&Array.isArray(e.courses)?s=e.courses:(console.warn("Unexpected courses data format:",e),s=[]),console.log("Processed courses array:",s),d(s),C.current=!0}catch(e){console.error("Error fetching courses:",e),s({type:"error",message:"Failed to fetch courses: ".concat(e.message),duration:7e3}),d([])}finally{y(!1)}})()},[x]);const w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(T.current)try{y(!0);const s=await(0,n.bh)(T.current,e,0,10,"createdAt","desc");console.log("Raw courses API response (fetchCourses):",s),console.log("Courses data type:",typeof s),console.log("Courses is array:",Array.isArray(s));let r=[];Array.isArray(s)?r=s:s&&Array.isArray(s.content)?r=s.content:s&&Array.isArray(s.data)?r=s.data:s&&s.courses&&Array.isArray(s.courses)?r=s.courses:(console.warn("Unexpected courses data format (fetchCourses):",s),r=[]),console.log("Processed courses array (fetchCourses):",r),d(r)}catch(r){console.error("Error fetching courses:",r),s({type:"error",message:"Failed to fetch courses: ".concat(r.message),duration:7e3}),d([])}finally{y(!1)}},E=e=>{var s;console.log("=== EDIT COURSE DEBUG ==="),console.log("Editing course:",e),console.log("Available courseTypes:",u),console.log("CourseTypes length:",u.length);let r="";if(e.courseTypeId)r=e.courseTypeId,console.log("Found courseTypeId:",r);else if(null!==(s=e.courseType)&&void 0!==s&&s.id)r=e.courseType.id,console.log("Found courseType.id:",r);else if(e.courseTypeName){const s=u.find(s=>s.name===e.courseTypeName);s&&(r=s.id,console.log("Found courseType by name match:",r))}else"string"===typeof e.courseType?(r=e.courseType,console.log("Found courseType as string:",r)):"number"===typeof e.courseType&&(r=e.courseType.toString(),console.log("Found courseType as number:",r));console.log("Final extracted courseTypeId:",r),console.log("CourseTypeId type:",typeof r);const a=u.find(e=>e.id===parseInt(r));console.log("Matching courseType found:",a);const t=u.map(e=>e.id);console.log("Available courseType IDs:",t),console.log("Is courseTypeId in available IDs?",t.includes(parseInt(r)));const o={name:e.name||"",description:e.description||"",courseType:{id:r},displayOrder:e.displayOrder||"",isActive:void 0===e.isActive||e.isActive};console.log("Setting formData to:",o),A(o),v(e.id),g(!0),console.log("=== END EDIT DEBUG ===")},I=async r=>{if(window.confirm("Are you sure you want to delete this course?"))try{y(!0),await(0,c.zs)(e,r),s({type:"success",message:"Course deleted successfully",duration:3e3}),(0,n.Ec)(),await w(x)}catch(a){console.error("Error deleting course:",a),s({type:"error",message:"Failed to delete course",duration:5e3})}finally{y(!1)}},F=()=>{A({name:"",description:"",courseType:{id:""},displayOrder:"",isActive:!0}),v(null),g(!1)},O=(()=>{const e={};return r.forEach(s=>{var r;const a=(e=>{if(!e)return"Unknown";const s=u.find(s=>s.id===parseInt(e));return s?s.name:"Unknown"})((null===(r=s.courseType)||void 0===r?void 0:r.id)||s.courseTypeId);e[a]||(e[a]=[]),e[a].push(s)}),e})(),k=Object.keys(O).sort();return(0,i.jsxs)("div",{className:"master-data-component",children:[(0,i.jsxs)("div",{className:"component-header",children:[(0,i.jsxs)("div",{className:"header-info",children:[(0,i.jsx)("h2",{children:"Course Management"}),(0,i.jsx)("p",{children:"Manage courses for different course types (e.g., Mathematics, Science, English)"})]}),(0,i.jsx)("div",{style:{display:"flex",gap:"10px"},children:(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"Add Course"})})]}),(0,i.jsx)("div",{className:"filter-section",children:(0,i.jsxs)("div",{className:"filter-group",children:[(0,i.jsx)("label",{htmlFor:"course-type-filter",children:"Filter by Course Type:"}),(0,i.jsxs)("select",{id:"course-type-filter",value:x,onChange:e=>j(e.target.value),className:"filter-select",children:[(0,i.jsx)("option",{value:"",children:"All Course Types"}),u.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),h&&(0,i.jsxs)("div",{className:"form-section",children:[(0,i.jsxs)("div",{className:"form-header",children:[(0,i.jsx)("h3",{children:f?"Edit Course":"Add New Course"}),(0,i.jsx)("button",{className:"btn btn-outline btn-sm",onClick:F,children:"Cancel"})]}),(0,i.jsxs)("form",{onSubmit:async r=>{r.preventDefault();try{if(y(!0),!b.name||!b.name.trim())return void s({type:"error",message:"Course name is required",duration:5e3});if(!b.courseType.id)return void s({type:"error",message:"Course type is required",duration:5e3});const r={name:b.name.trim(),description:b.description?b.description.trim():"",courseType:{id:parseInt(b.courseType.id)},displayOrder:b.displayOrder?parseInt(b.displayOrder):0,isActive:b.isActive};console.log("Form data being submitted:",r),console.log("Token available:",!!e),f?(console.log("Update data being submitted:",r),await(0,c.J4)(e,f,r),s({type:"success",message:"Course updated successfully",duration:3e3}),(0,n.Ec)(),await w(x)):(await(0,c.C_)(e,r),s({type:"success",message:"Course created successfully",duration:3e3}),(0,n.Ec)(),await w(x)),g(!1),v(null),A({name:"",description:"",courseType:{id:""},displayOrder:"",isActive:!0})}catch(a){console.error("Error saving course:",a),s({type:"error",message:"Failed to save course: ".concat(a.message),duration:5e3})}finally{y(!1)}},className:"master-data-form",children:[(0,i.jsxs)("div",{className:"form-row",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"name",children:"Course Name *"}),(0,i.jsx)("input",{type:"text",id:"name",name:"name",value:b.name,onChange:e=>A((0,a.A)((0,a.A)({},b),{},{name:e.target.value})),className:"form-input",required:!0,placeholder:"e.g., Mathematics, Science, English"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"courseType",children:"Course Type *"}),(0,i.jsxs)("select",{id:"courseType",name:"courseType",value:b.courseType.id,onChange:e=>A((0,a.A)((0,a.A)({},b),{},{courseType:{id:e.target.value}})),className:"form-input",required:!0,children:[(0,i.jsx)("option",{value:"",children:"Select Course Type"}),0===u.length?(0,i.jsx)("option",{value:"",disabled:!0,children:"No Course Types Available"}):u.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,i.jsx)("div",{className:"form-row",children:(0,i.jsxs)("div",{className:"form-group full-width",children:[(0,i.jsx)("label",{htmlFor:"description",children:"Description"}),(0,i.jsx)("textarea",{id:"description",name:"description",value:b.description,onChange:e=>A((0,a.A)((0,a.A)({},b),{},{description:e.target.value})),className:"form-input",placeholder:"Brief description of this course",rows:3})]})}),(0,i.jsxs)("div",{className:"form-row",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"displayOrder",children:"Display Order"}),(0,i.jsx)("input",{type:"number",id:"displayOrder",name:"displayOrder",value:b.displayOrder,onChange:e=>A((0,a.A)((0,a.A)({},b),{},{displayOrder:e.target.value})),className:"form-input",placeholder:"e.g., 1, 2, 3",min:"1"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"isActive",children:"Status"}),(0,i.jsxs)("select",{id:"isActive",name:"isActive",value:b.isActive,onChange:e=>A((0,a.A)((0,a.A)({},b),{},{isActive:"true"===e.target.value})),className:"form-input",children:[(0,i.jsx)("option",{value:!0,children:"Active"}),(0,i.jsx)("option",{value:!1,children:"Inactive"})]})]})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-outline",onClick:F,children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:m,children:m?"Saving...":f?"Update Course":"Create Course"})]})]})]}),(0,i.jsxs)("div",{className:"data-section",children:[(0,i.jsxs)("div",{className:"data-header",children:[(0,i.jsxs)("h3",{children:["Courses (",r.length,")"]}),(0,i.jsx)("div",{className:"data-actions",children:(0,i.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>w(x),disabled:m,children:"Refresh"})})]}),m?(0,i.jsxs)("div",{className:"loading-state",children:[(0,i.jsx)("div",{className:"loading-spinner"}),(0,i.jsx)("p",{children:"Loading courses..."})]}):0===r.length?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-icon",children:"\ud83d\udcda"}),(0,i.jsx)("h4",{children:"No Courses Found"}),(0,i.jsx)("p",{children:"Create your first course to get started"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"Add Course"})]}):0===k.length?(0,i.jsxs)("div",{className:"empty-state",children:[(0,i.jsx)("div",{className:"empty-icon",children:"No Courses"}),(0,i.jsx)("h4",{children:"No Courses Found"}),(0,i.jsx)("p",{children:"Create your first course to get started"}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>g(!0),children:"Add Course"})]}):(0,i.jsx)("div",{className:"courses-by-type",children:k.map(e=>(0,i.jsxs)("div",{className:"course-type-section",children:[(0,i.jsx)("div",{className:"section-header",children:(0,i.jsxs)("h4",{children:[e," (",O[e].length,")"]})}),(0,i.jsx)("div",{className:"data-grid",children:O[e].map(e=>{const s=[{key:"displayOrder",label:"Display Order",condition:e=>void 0!==e.displayOrder&&null!==e.displayOrder&&0!==e.displayOrder}];return(0,i.jsx)(l,{item:e,itemType:"course",onEdit:E,onDelete:I,fields:s},e.id)})})]},e))})]})]})}}}]);
//# sourceMappingURL=469.949447a4.chunk.js.map