"use strict";(self.webpackChunklearning_management_system=self.webpackChunklearning_management_system||[]).push([[588],{588:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var r=a(555),t=a(43),l=a(580),n=a(872),c=a(712),o=(a(595),a(579));const i=e=>{let{item:s,itemType:a="item",onEdit:r,onDelete:t,fields:l=[],badges:n=[]}=e;const c=()=>s.description,i=()=>s.createdByName;return(0,o.jsxs)("div",{className:"data-card",children:[(0,o.jsxs)("div",{className:"card-header",children:[(0,o.jsxs)("div",{className:"card-title",children:[(0,o.jsx)("h4",{children:(()=>{switch(a){case"subject":return s.subjectName||s.name;case"topic":return s.topicName||s.name;default:return s.name}})()}),(0,o.jsxs)("div",{className:"card-badges",children:[(0,o.jsx)("span",{className:"status-badge ".concat(s.isActive?"active":"inactive"),children:s.isActive?"Active":"Inactive"}),n.map(e=>{const{key:a,label:r,value:t,condition:l,style:n,icon:c}=e;if(l&&!l(s))return null;const i=t||s[a];return i?(0,o.jsxs)("span",{className:"structure-badge",style:n,children:[c," ",i]},a):null})]})]}),(0,o.jsxs)("div",{className:"card-actions",children:[(0,o.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>{r&&r(s)},children:"Edit"}),(0,o.jsx)("button",{className:"btn btn-danger btn-xs",onClick:()=>{t&&t(s.id)},children:"Delete"})]})]}),(0,o.jsxs)("div",{className:"card-content",children:[c()&&(0,o.jsx)("p",{className:"description",children:c()}),l.map(e=>{const{key:a,label:r,value:t,condition:l}=e;if(l&&!l(s))return null;const n="function"===typeof t?t(s):t||s[a];return n?(0,o.jsxs)("p",{children:[(0,o.jsxs)("strong",{children:[r,":"]})," ",n]},a):null})]}),(0,o.jsx)("div",{className:"card-footer",children:(0,o.jsxs)("small",{className:"text-muted",children:["Created: ",new Date(s.createdAt).toLocaleDateString(),i()&&(0,o.jsxs)("span",{children:[" by ",i()]})]})})]})},d=()=>{var e,s,a;const{token:d,addNotification:u}=(0,l.nm)(),[m,y]=(0,t.useState)([]),[p,h]=(0,t.useState)([]),[g,j]=(0,t.useState)(!1),[v,f]=(0,t.useState)(!1),[b,x]=(0,t.useState)(null),[A,C]=(0,t.useState)(""),[N,S]=(0,t.useState)(""),[I,T]=(0,t.useState)(""),[w,E]=(0,t.useState)(""),[k,F]=(0,t.useState)(!0),[O,M]=(0,t.useState)({name:"",description:"",masterSubjectId:"",courseType:{id:""},course:{id:""},class:{id:""},exam:{id:""},displayOrder:"",isActive:!0}),[L,P]=(0,t.useState)([]),[R,U]=(0,t.useState)([]),[D,B]=(0,t.useState)([]),[G,J]=(0,t.useState)([]),[W,_]=(0,t.useState)([]),[q,H]=(0,t.useState)([]),[K,z]=(0,t.useState)([]),[V,Q]=(0,t.useState)({courses:!1,classes:!1,exams:!1,masterSubjects:!1}),Y=(0,t.useRef)(null),X=(0,t.useRef)({data:null,ts:0}),Z=(0,t.useRef)(null),$=(0,t.useRef)(new Map),ee=(0,t.useRef)(""),se=(0,t.useRef)(0);(0,t.useEffect)(()=>()=>{if(Y.current)try{Y.current.abort()}catch(e){}if(Z.current)try{Z.current.abort()}catch(e){}},[]);const ae=(0,t.useRef)(!1);(0,t.useEffect)(()=>{d&&!ae.current&&(ae.current=!0,me(),(async()=>{try{const e=await(0,c.sW)(d,{}),s=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.content)||(null===e||void 0===e?void 0:e.data)||[];y(s||[]),$.current.set("ALL_LINKAGES",{data:s||[],ts:Date.now()}),console.log("Loaded ALL_LINKAGES into subjects. Count:",(s||[]).length)}catch(e){console.warn("All-linkages preload failed:",(null===e||void 0===e?void 0:e.message)||e)}})())},[d]);const re=(0,t.useRef)(!1),te=(0,t.useRef)(!1),le=(0,t.useRef)(!1),ne=(0,t.useRef)(!1),ce=(0,t.useRef)(!1);(0,t.useEffect)(()=>{if(re.current)if(console.log("=== COURSE TYPE CHANGE EFFECT ==="),console.log("Selected course type changed:",A),console.log("Selected course type type:",typeof A),console.log("Selected course type length:",null===A||void 0===A?void 0:A.length),A){const e=parseInt(A);console.log("Filtering courses for course type:",e),de(e),S(""),T(""),E(""),_([]),H([]),y([]),(async()=>{try{console.log("About to fetch subjects via /api/admin/subjects/all-linkages?courseTypeId=.. :",e),y([]);const s=await(0,c.sW)(d,{courseTypeId:e}),a=Array.isArray(s)?s:(null===s||void 0===s?void 0:s.content)||(null===s||void 0===s?void 0:s.data)||[];y(Array.isArray(a)?a:[])}catch(s){console.warn("Fetch subjects by courseType failed:",(null===s||void 0===s?void 0:s.message)||s)}})()}else console.log("No course type selected - clearing subjects until a filter is applied"),J(Array.isArray(L)?L:[]),z([]),S(""),T(""),E(""),_([]),H([]),y([]);else re.current=!0},[A,k]),(0,t.useEffect)(()=>{if(te.current)if(N){const e=parseInt(N),s=A?parseInt(A):null;console.log("=== COURSE CHANGE EFFECT ==="),console.log("Selected course changed:",e,"course type:",s),console.log("About to fetch subjects via all-linkages with courseId & courseTypeId:",e,s),ue(s,e),T(""),E(""),y([]),(async()=>{try{const a=await(0,c.sW)(d,{courseId:e,courseTypeId:s}),r=Array.isArray(a)?a:(null===a||void 0===a?void 0:a.content)||(null===a||void 0===a?void 0:a.data)||[];y(Array.isArray(r)?r:[])}catch(a){console.warn("Fetch subjects by course (all-linkages) failed:",(null===a||void 0===a?void 0:a.message)||a),y([])}})()}else _([]),H([]),T(""),E("");else te.current=!0},[N,A,k]),(0,t.useEffect)(()=>{if(le.current){if(I){const e=parseInt(I);console.log("Selected class changed:",e),E(""),M(e=>(0,r.A)((0,r.A)({},e),{},{name:"",description:"",masterSubjectId:""}));const s=A?parseInt(A):null,a=N?parseInt(N):null;ye(s,a,e,null,k)}}else le.current=!0},[I,A,N]),(0,t.useEffect)(()=>{if(ne.current){if(w){const e=parseInt(w);console.log("Selected exam changed:",e),T(""),M(e=>(0,r.A)((0,r.A)({},e),{},{name:"",description:"",masterSubjectId:""})),y([]);const s=A?parseInt(A):null,a=N?parseInt(N):null;ye(s,a,null,e,k)}}else ne.current=!0},[w,A,N]),(0,t.useEffect)(()=>{if(!ce.current)return void(ce.current=!0);console.log("Show active only changed:",k);const e=A?parseInt(A):null,s=N?parseInt(N):null,a=I?parseInt(I):null,r=w?parseInt(w):null;ye(e,s,a,r,k)},[k]),(0,t.useEffect)(()=>{console.log("Master subjects state changed:",K),console.log("Master subjects length:",K.length)},[K]);const oe=(()=>{const e={};return m.forEach(s=>{var a;const r=(e=>{if(!Array.isArray(p))return console.warn("courseTypes is not an array:",p),"Unknown";const s=p.find(s=>s.id===e);return s?s.name:"Unknown"})(s.courseTypeId||(null===(a=s.courseType)||void 0===a?void 0:a.id));e[r]||(e[r]=[]),e[r].push(s)}),e})(),ie=Object.keys(oe).sort(),de=async e=>{if(e&&d)try{var s;console.log("Fetching courses for course type:",e);const a=await(0,c.NJ)(d,e,0,100,"createdAt","desc");console.log("Raw courses API response (fetchCoursesByCourseType):",a),console.log("Courses data type:",typeof a),console.log("Courses is array:",Array.isArray(a)),console.log("Has content property:",!!a.content),console.log("Content is array:",Array.isArray(a.content)),console.log("Content length:",null===(s=a.content)||void 0===s?void 0:s.length);let r=[];Array.isArray(a)?r=a:a&&Array.isArray(a.content)?r=a.content:a&&Array.isArray(a.data)?r=a.data:a&&a.courses&&Array.isArray(a.courses)?r=a.courses:(console.warn("Unexpected courses data format (fetchCoursesByCourseType):",a),r=[]),console.log("Processed courses array (fetchCoursesByCourseType):",r),J(r)}catch(a){console.error("Error fetching courses by course type:",a),J([])}else J([])},ue=async(e,s)=>{if(!s||!d)return _([]),void H([]);try{var a,r;console.log("Fetching classes and exams for course type:",e,"course:",s);const[t,l]=await Promise.all([(0,c.tW)(d,s,0,100,"createdAt","desc"),(0,c.rJ)(d,s,0,100,"createdAt","desc")]);console.log("Raw classes API response (fetchClassesAndExamsByCourse):",t),console.log("Raw exams API response (fetchClassesAndExamsByCourse):",l),console.log("Classes has content property:",!!t.content),console.log("Classes content length:",null===(a=t.content)||void 0===a?void 0:a.length),console.log("Exams has content property:",!!l.content),console.log("Exams content length:",null===(r=l.content)||void 0===r?void 0:r.length);let n=[];Array.isArray(t)?n=t:t&&Array.isArray(t.content)?n=t.content:t&&Array.isArray(t.data)?n=t.data:t&&t.classes&&Array.isArray(t.classes)?n=t.classes:(console.warn("Unexpected classes data format (fetchClassesAndExamsByCourse):",t),n=[]);let o=[];Array.isArray(l)?o=l:l&&Array.isArray(l.content)?o=l.content:l&&Array.isArray(l.data)?o=l.data:l&&l.exams&&Array.isArray(l.exams)?o=l.exams:(console.warn("Unexpected exams data format (fetchClassesAndExamsByCourse):",l),o=[]),console.log("Processed classes array (fetchClassesAndExamsByCourse):",n),console.log("Processed exams array (fetchClassesAndExamsByCourse):",o),_(n),H(o)}catch(t){console.error("Error fetching classes and exams by course:",t),_([]),H([])}},me=async()=>{try{var e;j(!0);let a=null;const r=Date.now();if(X.current.data&&r-X.current.ts<5e3)a=X.current.data;else{if(Y.current)try{Y.current.abort()}catch(s){}Y.current=new AbortController,a=await(0,n.RG)(d),X.current={data:a,ts:r}}y([]),console.log("Raw courseTypes API response (SubjectManagement):",a),console.log("CourseTypes data type:",typeof a),console.log("CourseTypes is array:",Array.isArray(a));let t=[];Array.isArray(a)?t=a:a&&Array.isArray(a.content)?t=a.content:a&&Array.isArray(a.data)?t=a.data:a&&a.courseTypes&&Array.isArray(a.courseTypes)?t=a.courseTypes:(console.warn("Unexpected courseTypes data format (SubjectManagement):",a),t=[]),console.log("Processed courseTypes array (SubjectManagement):",t),h(t),P([]),U([]),B([]),J([]),_([]),H([]),console.log("=== SUBJECT MANAGEMENT FETCH DEBUG ==="),console.log("Course types raw data:",a),console.log("Course types type:",typeof a),console.log("Course types is array:",Array.isArray(a)),console.log("Course types length:",null===(e=a)||void 0===e?void 0:e.length),console.log("Initial load: only course types fetched; subjects deferred until filters applied"),console.log("=====================================")}catch(a){console.error("Error fetching data:",a)}finally{j(!1)}},ye=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{var l,n;if(j(!0),console.log("=== FETCH SUBJECTS DEBUG ==="),console.log("fetchSubjects called with filters:",{courseTypeId:e,courseId:s,classId:a,examId:r,active:t}),console.log("Token available:",!!d),!e&&!s&&!a&&!r)return console.log("No filters provided; skipping subjects API call"),void y([]);const i="ct:".concat(e||"","|c:").concat(s||"","|cl:").concat(a||"","|e:").concat(r||"","|a:").concat(t?"1":"0"),u=Date.now(),m=$.current.get(i);let p;if(m&&u-m.ts<5e3)p=m.data;else if(i===ee.current&&u-se.current<2e3)p=[];else{if(Z.current)try{Z.current.abort()}catch(o){}Z.current=new AbortController,ee.current=i,se.current=u,p=await(0,c.sW)(d,{courseTypeId:e,courseId:s,classId:a,examId:r,active:t}),$.current.set(i,{data:p,ts:u})}console.log("Fetched subjects raw data:",p);let h=Array.isArray(p)?p:(null===(l=p)||void 0===l?void 0:l.content)||(null===(n=p)||void 0===n?void 0:n.data)||[];Array.isArray(h)||(h=[]),console.log("Final subjects array (linkages):",h),y(h)}catch(i){console.error("Error fetching subjects:",i)}finally{j(!1)}},pe=()=>{M({name:"",description:"",courseType:{id:""},course:{id:""},class:{id:""},exam:{id:""},displayOrder:"",isActive:!0}),x(null),f(!1),P([]),U([]),B([]),z([])};return(0,o.jsxs)("div",{className:"master-data-component",children:[(0,o.jsxs)("div",{className:"component-header",children:[(0,o.jsxs)("div",{className:"header-info",children:[(0,o.jsx)("h2",{children:"Subject Management"}),(0,o.jsx)("p",{children:"Create subjects once per course type. Subjects are shared across all classes within a course type."})]}),(0,o.jsx)("div",{className:"header-actions",children:(0,o.jsx)("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"Add Subject"})})]}),(0,o.jsxs)("div",{className:"filter-section",children:[(0,o.jsxs)("div",{className:"filter-header",children:[(0,o.jsx)("h4",{children:"Filter Subjects"}),(0,o.jsxs)("div",{className:"filter-header-controls",children:[(0,o.jsxs)("label",{className:"filter-checkbox",children:[(0,o.jsx)("input",{type:"checkbox",checked:k,onChange:e=>F(e.target.checked)}),(0,o.jsx)("span",{children:"Active Only"})]}),(0,o.jsx)("button",{className:"btn btn-outline btn-xs",onClick:()=>{C(""),S(""),T(""),E(""),J([]),_([]),H([])},disabled:g,children:"Clear All Filters"})]})]}),g&&0===p.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"No Subjects"}),(0,o.jsx)("h4",{children:"Loading Course Types..."}),(0,o.jsx)("p",{children:"Please wait while we load the course types"})]}):(0,o.jsxs)("div",{className:"filter-row",children:[(0,o.jsxs)("div",{className:"filter-group",children:[(0,o.jsx)("label",{htmlFor:"course-type-filter",children:"1. Course Type:"}),(0,o.jsxs)("select",{id:"course-type-filter",value:A,onChange:e=>C(e.target.value),className:"filter-select",children:[(0,o.jsx)("option",{value:"",children:"Select Course Type"}),Array.isArray(p)&&p.length>0?p.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)):(0,o.jsx)("option",{value:"",disabled:!0,children:"Loading course types..."})]})]}),(0,o.jsxs)("div",{className:"filter-group",children:[(0,o.jsx)("label",{htmlFor:"course-filter",children:"2. Course:"}),(0,o.jsxs)("select",{id:"course-filter",value:N,onChange:e=>S(e.target.value),className:"filter-select",disabled:!A,children:[(0,o.jsx)("option",{value:"",children:"Select Course"}),Array.isArray(G)&&G.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(e=>{const s=p.find(s=>s.id===parseInt(e));return s&&s.name&&s.name.toLowerCase().includes("academic")})(A)&&(0,o.jsxs)("div",{className:"filter-group",children:[(0,o.jsx)("label",{htmlFor:"class-filter",children:"3. Class:"}),(0,o.jsxs)("select",{id:"class-filter",value:I,onChange:e=>T(e.target.value),className:"filter-select",disabled:!N,children:[(0,o.jsx)("option",{value:"",children:"Select Class"}),Array.isArray(W)&&W.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(e=>{const s=p.find(s=>s.id===parseInt(e));return s&&s.name&&s.name.toLowerCase().includes("competitive")})(A)&&(0,o.jsxs)("div",{className:"filter-group",children:[(0,o.jsx)("label",{htmlFor:"exam-filter",children:"3. Exam:"}),(0,o.jsxs)("select",{id:"exam-filter",value:w,onChange:e=>E(e.target.value),className:"filter-select",disabled:!N,children:[(0,o.jsx)("option",{value:"",children:"Select Exam"}),Array.isArray(q)&&q.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]}),v&&(0,o.jsxs)("div",{className:"form-section",children:[(0,o.jsxs)("div",{className:"form-header",children:[(0,o.jsx)("h3",{children:b?"Edit Subject":"Add New Subject"}),(0,o.jsx)("button",{className:"btn btn-outline btn-sm",onClick:pe,children:"Cancel"})]}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{if(j(!0),!O.name||!O.name.trim())return void u({type:"error",message:"Master subject selection is required",duration:5e3});if(!O.courseType.id)return void u({type:"error",message:"Course type is required",duration:5e3});const e=parseInt(O.courseType.id),t=O.masterSubjectId?parseInt(O.masterSubjectId):null,l=O.displayOrder?parseInt(O.displayOrder):0;if(!t)return void u({type:"error",message:"Please select a subject",duration:4e3});if(b){const s={name:O.name.trim(),description:O.description?O.description.trim():"",courseTypeId:e,displayOrder:l,isActive:O.isActive};await(0,c.iQ)(d,b,s),u({type:"success",message:"Subject updated successfully",duration:3e3})}else{const n={subjectId:t,displayOrder:l};if(1===e){var s;if(null===(s=O.class)||void 0===s||!s.id)return void u({type:"error",message:"Please select a Class to link the subject",duration:4e3});n.classId=parseInt(O.class.id),n.isActive=!!O.isActive}else if(2===e){var a;if(null===(a=O.exam)||void 0===a||!a.id)return void u({type:"error",message:"Please select an Exam to link the subject",duration:4e3});n.examId=parseInt(O.exam.id),O.weightage&&(n.weightage=parseInt(O.weightage))}else{if(3!==e)return void u({type:"error",message:"Unsupported course type for linking",duration:4e3});var r;if(null===(r=O.course)||void 0===r||!r.id)return void u({type:"error",message:"Please select a Course to link the subject",duration:4e3});n.courseId=parseInt(O.course.id),void 0!==O.isCompulsory&&(n.isCompulsory=!!O.isCompulsory)}await(0,c.kV)(d,n),u({type:"success",message:"Subject linked successfully",duration:3e3})}f(!1),x(null),M({name:"",description:"",masterSubjectId:"",courseType:{id:""},course:{id:""},class:{id:""},exam:{id:""},displayOrder:"",isActive:!0});const n=A?parseInt(A):null,o=N?parseInt(N):null,i=I?parseInt(I):null,m=w?parseInt(w):null;if(console.log("Refreshing subjects after save with filters:",{refreshCourseTypeId:n,refreshCourseId:o,refreshClassId:i,refreshExamId:m,showActiveOnly:k}),n||o||i||m)await ye(n,o,i,m,k);else{console.log("No filters applied, fetching all subject linkages");const e=await(0,c.sW)(d,{}),s=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.content)||(null===e||void 0===e?void 0:e.data)||[];y(s||[]),$.current.set("ALL_LINKAGES",{data:s||[],ts:Date.now()})}}catch(t){console.error("Error saving subject:",t);let e="Failed to save subject";if(t.message)if(t.message.includes("Subject is already assigned to this class"))e="Subject is already assigned to this class. Please select a different subject or class.";else if(t.message.includes("Subject with name")&&t.message.includes("already exists"))e="A subject with this name already exists for this type. Please choose a different name.";else if(t.message.includes("400")){const s=t.message.split(" - ").pop();if(s&&s!==t.message)try{const a=JSON.parse(s);e=a.error||a.message||e}catch(l){e=s}}else e=t.message;u({type:"error",message:e,duration:5e3})}finally{j(!1)}},className:"master-data-form",children:[(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"courseType",children:"Course Type *"}),(0,o.jsxs)("select",{id:"courseType",name:"courseType",value:O.courseType.id,onChange:e=>(async e=>{if(M(s=>(0,r.A)((0,r.A)({},s),{},{courseType:{id:e},course:{id:""},class:{id:""},exam:{id:""},name:""})),P([]),U([]),B([]),e)try{var s,a;Q(e=>(0,r.A)((0,r.A)({},e),{},{courses:!0,masterSubjects:!0}));const[t,l]=await Promise.all([(0,c.NJ)(d,e,0,100,"createdAt","desc"),(0,c.ui)(d,e,{active:k})]);console.log("=== SUBJECT MANAGEMENT DEBUG ==="),console.log("Course Type ID:",e),console.log("Show Active Only:",k),console.log("Raw courses API response:",t),console.log("Raw master subjects API response:",l),console.log("Courses has content property:",!!t.content),console.log("Courses content length:",null===(s=t.content)||void 0===s?void 0:s.length),console.log("Master subjects has content property:",!!l.content),console.log("Master subjects content length:",null===(a=l.content)||void 0===a?void 0:a.length),console.log("Master subjects is array:",Array.isArray(l)),console.log("Master subjects type:",typeof l);let n=[];Array.isArray(t)?n=t:t&&Array.isArray(t.content)?n=t.content:t&&Array.isArray(t.data)?n=t.data:t&&t.courses&&Array.isArray(t.courses)?n=t.courses:(console.warn("Unexpected courses data format (handleCourseTypeChange):",t),n=[]);let o=n.filter(e=>!k||!!e.isActive);o.sort((e,s)=>(e.displayOrder||0)-(s.displayOrder||0)||e.name.localeCompare(s.name));let i=[];Array.isArray(l)?(i=l,console.log("Master subjects: Using direct array format")):l&&Array.isArray(l.content)?(i=l.content,console.log("Master subjects: Using content array format")):l&&Array.isArray(l.data)?(i=l.data,console.log("Master subjects: Using data array format")):l&&l.subjects&&Array.isArray(l.subjects)?(i=l.subjects,console.log("Master subjects: Using subjects array format")):(console.warn("Unexpected master subjects data format (handleCourseTypeChange):",l),i=[]),console.log("Master subjects array after processing:",i),console.log("Master subjects array length:",i.length);let u=i.filter(e=>!k||!!e.isActive).map(e=>({id:e.id,label:e.name||"",description:e.description||""}));u.sort((e,s)=>e.label.localeCompare(s.label)),console.log("Master subjects after normalization:",u),console.log("Normalized master subjects length:",u.length),P(o),z(u),console.log("Courses fetched:",n),console.log("Master subjects fetched:",u),console.log("Setting masterSubjects state with:",u.length,"items"),console.log("=== END SUBJECT MANAGEMENT DEBUG ===")}catch(t){console.error("Error fetching courses and master subjects:",t),u({type:"error",message:"Failed to fetch courses and master subjects: ".concat(t.message),duration:5e3}),P([]),z([])}finally{Q(e=>(0,r.A)((0,r.A)({},e),{},{courses:!1,masterSubjects:!1}))}else z([])})(e.target.value),className:"form-input",required:!0,children:[(0,o.jsx)("option",{value:"",children:"Select Course Type"}),Array.isArray(p)&&p.length>0?p.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)):(0,o.jsx)("option",{value:"",disabled:!0,children:"Loading course types..."})]})]})}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"course",children:"Course *"}),(0,o.jsxs)("select",{id:"course",name:"course",value:(null===(e=O.course)||void 0===e?void 0:e.id)||"",onChange:e=>(async e=>{if(M(s=>(0,r.A)((0,r.A)({},s),{},{course:{id:e},class:{id:""},exam:{id:""},name:"",description:"",masterSubjectId:""})),U([]),B([]),e&&O.courseType.id){const l=parseInt(O.courseType.id);console.log("Course changed:",e,"Course Type:",l);try{var s,a;Q(e=>(0,r.A)((0,r.A)({},e),{},{classes:!0,exams:!0}));const[t,l]=await Promise.all([(0,c.tW)(d,e,0,100,"createdAt","desc"),(0,c.rJ)(d,e,0,100,"createdAt","desc")]);console.log("Raw classes API response (handleCourseChange):",t),console.log("Raw exams API response (handleCourseChange):",l),console.log("Classes has content property:",!!t.content),console.log("Classes content length:",null===(s=t.content)||void 0===s?void 0:s.length),console.log("Exams has content property:",!!l.content),console.log("Exams content length:",null===(a=l.content)||void 0===a?void 0:a.length);let n=[];Array.isArray(t)?n=t:t&&Array.isArray(t.content)?n=t.content:t&&Array.isArray(t.data)?n=t.data:t&&t.classes&&Array.isArray(t.classes)?n=t.classes:(console.warn("Unexpected classes data format (handleCourseChange):",t),n=[]);let o=n.filter(e=>!k||!!e.isActive);o.sort((e,s)=>(e.displayOrder||0)-(s.displayOrder||0)||e.name.localeCompare(s.name));let i=[];Array.isArray(l)?i=l:l&&Array.isArray(l.content)?i=l.content:l&&Array.isArray(l.data)?i=l.data:l&&l.exams&&Array.isArray(l.exams)?i=l.exams:(console.warn("Unexpected exams data format (handleCourseChange):",l),i=[]);let u=i.filter(e=>!k||!!e.isActive);u.sort((e,s)=>(e.displayOrder||0)-(s.displayOrder||0)||e.name.localeCompare(s.name)),U(o),B(u),console.log("Classes fetched:",n),console.log("Exams fetched:",i)}catch(t){console.error("Error in handleCourseChange:",t),u({type:"error",message:"Failed to fetch classes and exams",duration:5e3}),U([]),B([])}finally{Q(e=>(0,r.A)((0,r.A)({},e),{},{classes:!1,exams:!1}))}}})(e.target.value),className:"form-input",disabled:!O.courseType.id||V.courses,required:!0,children:[(0,o.jsx)("option",{value:"",children:O.courseType.id?V.courses?"Loading courses...":"Select Course":"Select Course Type first"}),L.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"class",children:"Link to Specific Class"}),(0,o.jsxs)("select",{id:"class",name:"class",value:(null===(s=O.class)||void 0===s?void 0:s.id)||"",onChange:e=>M((0,r.A)((0,r.A)({},O),{},{class:{id:e.target.value}})),className:"form-input",disabled:"1"!==O.courseType.id||V.classes,children:[(0,o.jsx)("option",{value:"",children:"1"!==O.courseType.id?"Select Academic course type first":V.classes?"Loading classes...":"Select Class (Optional)"}),R.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)),"1"===O.courseType.id&&O.course.id&&0===R.length&&!V.classes&&(0,o.jsx)("option",{value:"",disabled:!0,children:"No classes available"})]})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"exam",children:"Link to Specific Exam"}),(0,o.jsxs)("select",{id:"exam",name:"exam",value:(null===(a=O.exam)||void 0===a?void 0:a.id)||"",onChange:e=>M((0,r.A)((0,r.A)({},O),{},{exam:{id:e.target.value}})),className:"form-input",disabled:"2"!==O.courseType.id||V.exams,children:[(0,o.jsx)("option",{value:"",children:"2"!==O.courseType.id?"Select Competitive course type first":V.exams?"Loading exams...":"Select Exam (Optional)"}),D.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id)),"2"===O.courseType.id&&O.course.id&&0===D.length&&!V.exams&&(0,o.jsx)("option",{value:"",disabled:!0,children:"No exams available"})]})]})]}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"masterSubject",children:"Master Subject *"}),(0,o.jsxs)("select",{id:"masterSubject",name:"masterSubject",value:O.name,onChange:e=>{const s=e.target.value,a=K.find(e=>e.label===s);M((0,r.A)((0,r.A)({},O),{},{name:s,description:(null===a||void 0===a?void 0:a.description)||"",masterSubjectId:(null===a||void 0===a?void 0:a.id)||""}))},className:"form-input",disabled:!O.courseType.id||V.masterSubjects,required:!0,children:[(0,o.jsx)("option",{value:"",children:O.courseType.id?V.masterSubjects?"Loading master subjects...":"Select Master Subject":"Select Course Type first"}),K.length>0?K.map(e=>(0,o.jsx)("option",{value:e.label,children:e.label},e.id)):(0,o.jsx)("option",{value:"",disabled:!0,children:"No master subjects available"})]}),K.length>0&&(0,o.jsxs)("small",{className:"form-help",children:[K.length," master subjects available"]})]})}),(0,o.jsxs)("div",{className:"form-row",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"displayOrder",children:"Display Order"}),(0,o.jsx)("input",{type:"number",id:"displayOrder",name:"displayOrder",value:O.displayOrder,onChange:e=>M((0,r.A)((0,r.A)({},O),{},{displayOrder:e.target.value})),className:"form-input",placeholder:"e.g., 1, 2, 3",min:"1"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"isActive",children:"Status"}),(0,o.jsxs)("select",{id:"isActive",name:"isActive",value:O.isActive,onChange:e=>M((0,r.A)((0,r.A)({},O),{},{isActive:"true"===e.target.value})),className:"form-input",children:[(0,o.jsx)("option",{value:!0,children:"Active"}),(0,o.jsx)("option",{value:!1,children:"Inactive"})]})]})]}),(0,o.jsx)("div",{className:"form-row",children:(0,o.jsxs)("div",{className:"form-group full-width",children:[(0,o.jsx)("label",{htmlFor:"description",children:"Description"}),(0,o.jsx)("textarea",{id:"description",name:"description",value:O.description,onChange:e=>M((0,r.A)((0,r.A)({},O),{},{description:e.target.value})),className:"form-input",placeholder:O.name?"Description from master subject":"Brief description of this subject",rows:3,readOnly:!!O.name,style:{backgroundColor:O.name?"#f8f9fa":"#fff",color:O.name?"#6c757d":"#2c3e50",cursor:O.name?"not-allowed":"text"}}),O.name&&(0,o.jsx)("small",{className:"form-help",children:"Description is automatically filled from the selected master subject"})]})}),(0,o.jsxs)("div",{className:"form-actions",children:[(0,o.jsx)("button",{type:"button",className:"btn btn-outline",onClick:pe,children:"Cancel"}),(0,o.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:g,children:g?"Saving...":b?"Update Subject":"Create Subject"})]})]})]}),(0,o.jsxs)("div",{className:"data-section",children:[(0,o.jsxs)("div",{className:"data-header",children:[(0,o.jsxs)("h3",{children:["Subjects (",(()=>{const e=A?parseInt(A):null;return Array.isArray(m)?e?1===e?m.filter(e=>1===e.courseTypeId||"ACADEMIC"===e.structureType).length:2===e?m.filter(e=>2===e.courseTypeId||"COMPETITIVE"===e.structureType).length:m.filter(e=>e.courseTypeId&&1!==e.courseTypeId&&2!==e.courseTypeId||"PROFESSIONAL"===e.structureType).length:m.length:0})(),")"]}),(0,o.jsx)("div",{className:"data-actions",children:(0,o.jsx)("button",{className:"btn btn-outline btn-sm",onClick:async()=>{const e=!!(A||N||I||w);j(!0);try{if(e){const e=A?parseInt(A):null,s=N?parseInt(N):null,a=I?parseInt(I):null,r=w?parseInt(w):null;await ye(e,s,a,r,k)}else{const e=await(0,c.sW)(d,{}),s=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.content)||(null===e||void 0===e?void 0:e.data)||[];y(s||[]),$.current.set("ALL_LINKAGES",{data:s||[],ts:Date.now()})}}catch(s){console.warn("Refresh failed:",(null===s||void 0===s?void 0:s.message)||s)}finally{j(!1)}},disabled:g,children:"Refresh"})})]}),g?(0,o.jsxs)("div",{className:"loading-state",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Loading subjects..."})]}):0===m.length||0===ie.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"No Subjects"}),(0,o.jsx)("h4",{children:"No Subjects Found"}),(0,o.jsx)("p",{children:"Create your first subject to get started"}),(0,o.jsx)("button",{className:"btn btn-primary",onClick:()=>f(!0),children:"Add Subject"})]}):(0,o.jsx)("div",{className:"subjects-container",children:(()=>{const e=m.filter(e=>{var s;const a=e.courseTypeId||(null===(s=e.courseType)||void 0===s?void 0:s.id);return 1===a||"1"===a}),s=m.filter(e=>{var s;const a=e.courseTypeId||(null===(s=e.courseType)||void 0===s?void 0:s.id);return 2===a||"2"===a}),a=m.filter(e=>{var s;const a=e.courseTypeId||(null===(s=e.courseType)||void 0===s?void 0:s.id);return 3===a||"3"===a}),r=[{key:"courseTypeName",label:"Course Type"},{key:"courseName",label:"Course"},{key:"className",label:"Class",condition:e=>e.className},{key:"examName",label:"Exam",condition:e=>e.examName},{key:"subjectType",label:"Subject Type"},{key:"structureType",label:"Structure Type"}],t=e=>(0,o.jsx)(i,{item:e,itemType:"subject",onEdit:e=>(e=>{var s;M({name:e.name,description:e.description||"",courseType:{id:(null===(s=e.courseType)||void 0===s?void 0:s.id)||""},course:{id:""},class:{id:""},exam:{id:""},displayOrder:e.displayOrder||"",isActive:e.isActive}),x(e.id),f(!0)})({id:e.subjectId,name:e.subjectName}),onDelete:()=>(async e=>{if(window.confirm("Are you sure you want to delete this subject?"))try{j(!0),await(0,c.gg)(d,e),u({type:"success",message:"Subject deleted successfully",duration:3e3});const s=A?parseInt(A):null,a=N?parseInt(N):null,r=I?parseInt(I):null,t=w?parseInt(w):null;ye(s,a,r,t,k)}catch(s){console.error("Error deleting subject:",s)}finally{j(!1)}})(e.subjectId),fields:r},"".concat(e.linkageId,"-").concat(e.subjectId));return(0,o.jsxs)(o.Fragment,{children:[e.length>0&&(0,o.jsxs)("div",{className:"subject-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h3",{children:"Academic Course Subjects"}),(0,o.jsxs)("span",{className:"section-count",children:["(",e.length," subjects)"]})]}),(0,o.jsx)("div",{className:"data-grid",children:e.map(t)})]}),s.length>0&&(0,o.jsxs)("div",{className:"subject-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h3",{children:"Competitive Course Subjects"}),(0,o.jsxs)("span",{className:"section-count",children:["(",s.length," subjects)"]})]}),(0,o.jsx)("div",{className:"data-grid",children:s.map(t)})]}),a.length>0&&(0,o.jsxs)("div",{className:"subject-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h3",{children:"Professional Course Subjects"}),(0,o.jsxs)("span",{className:"section-count",children:["(",a.length," subjects)"]})]}),(0,o.jsx)("div",{className:"data-grid",children:a.map(t)})]}),0===e.length&&0===s.length&&0===a.length&&(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"No Subjects"}),(0,o.jsx)("h4",{children:"No Subjects Found"}),(0,o.jsx)("p",{children:"No subjects match your current filters. Try adjusting your filter criteria or create a new subject."})]})]})})()})]})]})}}}]);
//# sourceMappingURL=588.3da3b93d.chunk.js.map